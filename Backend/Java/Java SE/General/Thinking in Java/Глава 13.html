<!DOCTYPE html>
<html dir="ltr" class="client-nojs" lang="ru"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><title>Глава 13 Thinking in Java 4th edition — WikiJava: Wiki of Java: викифицированные книги и статьи по Java</title>
<meta name="generator" content="MediaWiki 1.22.2">
<link rel="shortcut icon" href="http://wikijava.it-cache.net/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="http://wikijava.it-cache.net/opensearch_desc.php" title="WikiJava: Wiki of Java: викифицированные книги и статьи по Java (ru)">
<link rel="EditURI" type="application/rsd+xml" href="http://wikijava.it-cache.net/api.php@action=rsd">
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="WikiJava: Wiki of Java: викифицированные книги и статьи по Java&nbsp;— Atom-лента" href="http://wikijava.it-cache.net/index.php@title=%D0%A1%D0%BB%D1%83%D0%B6%D0%B5%D0%B1%D0%BD%D0%B0%D1%8F%253A%D0%A1%D0%B2%D0%B5%D0%B6%D0%B8%D0%B5_%D0%BF%D1%80%D0%B0%D0%B2%D0%BA%D0%B8&amp;feed=atom">
<link rel="stylesheet" href="%D0%93%D0%BB%D0%B0%D0%B2%D0%B0%2013_files/style3.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<style>a:lang(ar),a:lang(ckb),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: wjava2-wj_:resourceloader:filter:minify-css:7:32e7e505403c81fe0a24e297ef166436 */</style>

<script src="%D0%93%D0%BB%D0%B0%D0%B2%D0%B0%2013_files/style1.css"></script><script src="%D0%93%D0%BB%D0%B0%D0%B2%D0%B0%2013_files/load.html"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Глава_13_Thinking_in_Java_4th_edition","wgTitle":"Глава 13 Thinking in Java 4th edition","wgCurRevisionId":37,"wgRevisionId":37,"wgArticleId":27,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Книги","Java"],"wgBreakFrames":false,"wgPageContentLanguage":"ru","wgPageContentModel":"wikitext","wgSeparatorTransformTable":[",\t."," \t,"],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],"wgMonthNamesShort":["","янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"],"wgRelevantPageName":"Глава_13_Thinking_in_Java_4th_edition","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgVectorEnabledModules":{"collapsiblenav":true,"collapsibletabs":true,"editwarning":true,"expandablesearch":false,"footercleanup":false,"sectioneditlinks":false,"simplesearch":true,"experiments":true}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"vector-simplesearch":1,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,
"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"useeditwarning":1,"prefershttps":1,"language":"ru","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"variant":"ru"});},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: wjava2-wj_:resourceloader:filter:minify-js:7:07bb1f4d2452379e70abca47c4cde6d9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-java5 {line-height: normal;}
.source-java5 li, .source-java5 pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for java5
 * CSS class: source-java5, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.java5.source-java5 .de1, .java5.source-java5 .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.java5.source-java5  {font-family:monospace;}
.java5.source-java5 .imp {font-weight: bold; color: red;}
.java5.source-java5 li, .java5.source-java5 .li1 {font-weight: normal; vertical-align:top;}
.java5.source-java5 .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.java5.source-java5 .li2 {font-weight: bold; vertical-align:top;}
.java5.source-java5 .kw1 {color: #000000;  font-weight: bold;}
.java5.source-java5 .kw2 {color: #000000; font-weight: bold;}
.java5.source-java5 .kw3 {color: #006600; font-weight: bold;}
.java5.source-java5 .kw4 {color: #006600; font-weight: bold;}
.java5.source-java5 .kw5 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw6 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw7 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw8 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw9 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw10 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw11 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw12 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw13 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw14 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw15 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw16 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw17 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw18 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw19 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw20 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw21 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw22 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw23 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw24 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw25 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw26 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw27 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw28 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw29 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw30 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw31 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw32 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw33 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw34 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw35 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw36 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw37 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw38 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw39 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw40 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw41 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw42 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw43 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw44 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw45 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw46 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw47 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw48 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw49 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw50 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw51 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw52 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw53 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw54 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw55 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw56 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw57 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw58 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw59 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw60 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw61 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw62 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw63 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw64 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw65 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw66 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw67 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw68 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw69 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw70 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw71 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw72 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw73 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw74 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw75 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw76 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw77 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw78 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw79 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw80 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw81 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw82 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw83 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw84 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw85 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw86 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw87 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw88 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw89 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw90 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw91 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw92 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw93 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw94 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw95 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw96 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw97 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw98 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw99 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw100 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw101 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw102 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw103 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw104 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw105 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw106 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw107 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw108 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw109 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw110 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw111 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw112 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw113 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw114 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw115 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw116 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw117 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw118 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw119 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw120 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw121 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw122 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw123 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw124 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw125 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw126 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw127 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw128 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw129 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw130 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw131 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw132 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw133 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw134 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw135 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw136 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw137 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw138 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw139 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw140 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw141 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw142 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw143 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw144 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw145 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw146 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw147 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw148 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw149 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw150 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw151 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw152 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw153 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw154 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw155 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw156 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw157 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw158 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw159 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw160 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw161 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw162 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw163 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw164 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw165 {color: #003399; font-weight: bold;}
.java5.source-java5 .kw166 {color: #003399; font-weight: bold;}
.java5.source-java5 .co1 {color: #666666; font-style: italic;}
.java5.source-java5 .co2 {color: #006699;}
.java5.source-java5 .co3 {color: #008000; font-style: italic; font-weight: bold;}
.java5.source-java5 .coMULTI {color: #666666; font-style: italic;}
.java5.source-java5 .es0 {color: #000099; font-weight: bold;}
.java5.source-java5 .br0 {color: #009900;}
.java5.source-java5 .sy0 {color: #339933;}
.java5.source-java5 .st0 {color: #0000ff;}
.java5.source-java5 .nu0 {color: #cc66cc;}
.java5.source-java5 .me1 {color: #006633;}
.java5.source-java5 .me2 {color: #006633;}
.java5.source-java5 .ln-xtra, .java5.source-java5 li.ln-xtra, .java5.source-java5 div.ln-xtra {background-color: #ffc;}
.java5.source-java5 span.xtra { display:block; }

/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-java {line-height: normal;}
.source-java li, .source-java pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for java
 * CSS class: source-java, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.java.source-java .de1, .java.source-java .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.java.source-java  {font-family:monospace;}
.java.source-java .imp {font-weight: bold; color: red;}
.java.source-java li, .java.source-java .li1 {font-weight: normal; vertical-align:top;}
.java.source-java .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.java.source-java .li2 {font-weight: bold; vertical-align:top;}
.java.source-java .kw1 {color: #000000; font-weight: bold;}
.java.source-java .kw2 {color: #000066; font-weight: bold;}
.java.source-java .kw3 {color: #003399;}
.java.source-java .kw4 {color: #000066; font-weight: bold;}
.java.source-java .co1 {color: #666666; font-style: italic;}
.java.source-java .co2 {color: #006699;}
.java.source-java .co3 {color: #008000; font-style: italic; font-weight: bold;}
.java.source-java .coMULTI {color: #666666; font-style: italic;}
.java.source-java .es0 {color: #000099; font-weight: bold;}
.java.source-java .br0 {color: #009900;}
.java.source-java .sy0 {color: #339933;}
.java.source-java .st0 {color: #0000ff;}
.java.source-java .nu0 {color: #cc66cc;}
.java.source-java .me1 {color: #006633;}
.java.source-java .me2 {color: #006633;}
.java.source-java .ln-xtra, .java.source-java li.ln-xtra, .java.source-java div.ln-xtra {background-color: #ffc;}
.java.source-java span.xtra { display:block; }

/*]]>*/
</style><!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Глава_13_Thinking_in_Java_4th_edition skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<h1 id="firstHeading" class="firstHeading" lang="ru"><span dir="auto">Глава 13 Thinking in Java 4th edition</span></h1>
			<div id="bodyContent">
								<div id="siteSub">Материал из WikiJava: Wiki of Java: викифицированные книги и статьи по Java</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Перейти к:					<a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#mw-navigation">навигация</a>, 					<a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#p-search">поиск</a>
				</div>
				<div id="mw-content-text" dir="ltr" class="mw-content-ltr" lang="ru"><table style="clear: right; margin-bottom: .5em; float: right; padding: .5em 0 .8em 1.4em; background: none; width: auto;" cellpadding="0" cellspacing="0">
<tbody><tr>
<td> <div id="toc" class="toc"><div id="toctitle"><h2>Содержание</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.98.D0.9D.D0.A4.D0.9E.D0.A0.D0.9C.D0.90.D0.A6.D0.98.D0.AF_.D0.9E_.D0.A2.D0.98.D0.9F.D0.90.D0.A5"><span class="tocnumber">1</span> <span class="toctext"><b>ИНФОРМАЦИЯ О ТИПАХ</b></span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.9D.D0.B5.D0.BE.D0.B1.D1.85.D0.BE.D0.B4.D0.B8.D0.BC.D0.BE.D1.81.D1.82.D1.8C_.D0.B2_.D0.B4.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.BE.D0.BC_.D0.BE.D0.BF.D1.80.D0.B5.D0.B4.D0.B5.D0.BB.D0.B5.D0.BD.D0.B8.D0.B8_.D1.82.D0.B8.D0.BF.D0.BE.D0.B2_.28RTTI.29"><span class="tocnumber">1.1</span> <span class="toctext"><b>Необходимость в динамическом определении типов (<i>RTTI</i>)</b></span></a></li>
<li class="toclevel-2 tocsection-3"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.9E.D0.B1.D1.8A.D0.B5.D0.BA.D1.82_Class"><span class="tocnumber">1.2</span> <span class="toctext"><b>Объект Class</b></span></a></li>
<li class="toclevel-2 tocsection-4"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.9B.D0.B8.D1.82.D0.B5.D1.80.D0.B0.D0.BB.D1.8B_class"><span class="tocnumber">1.3</span> <span class="toctext"><b>Литералы class</b></span></a></li>
<li class="toclevel-2 tocsection-5"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.9F.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D0.B8.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.BD.D1.8B.D0.B5_.D1.81.D1.81.D1.8B.D0.BB.D0.BA.D0.B8"><span class="tocnumber">1.4</span> <span class="toctext"><b>Параметризованные ссылки</b></span></a></li>
<li class="toclevel-2 tocsection-6"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.9D.D0.BE.D0.B2.D1.8B.D0.B9_.D1.81.D0.B8.D0.BD.D1.82.D0.B0.D0.BA.D1.81.D0.B8.D1.81_.D0.BF.D1.80.D0.B5.D0.BE.D0.B1.D1.80.D0.B0.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F"><span class="tocnumber">1.5</span> <span class="toctext"><b>Новый синтаксис преобразования</b></span></a></li>
<li class="toclevel-2 tocsection-7"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.BF.D0.B5.D1.80.D0.B5.D0.B4_.D0.BF.D1.80.D0.B8.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5.D0.BC_.D1.82.D0.B8.D0.BF.D0.BE.D0.B2"><span class="tocnumber">1.6</span> <span class="toctext"><b>Проверка перед приведением типов</b></span></a></li>
<li class="toclevel-2 tocsection-8"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BB.D0.B8.D1.82.D0.B5.D1.80.D0.B0.D0.BB.D0.BE.D0.B2_class"><span class="tocnumber">1.7</span> <span class="toctext"><b>Использование литералов class</b></span></a></li>
<li class="toclevel-2 tocsection-9"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.94.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D0.B2.D1.8B.D0.B7.D0.BE.D0.B2_instanceof"><span class="tocnumber">1.8</span> <span class="toctext"><b>Динамический вызов instanceof</b></span></a></li>
<li class="toclevel-2 tocsection-10"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.A0.D0.B5.D0.BA.D1.83.D1.80.D1.81.D0.B8.D0.B2.D0.BD.D1.8B.D0.B9_.D0.BF.D0.BE.D0.B4.D1.81.D1.87.D0.B5.D1.82"><span class="tocnumber">1.9</span> <span class="toctext"><b>Рекурсивный подсчет</b></span></a></li>
<li class="toclevel-2 tocsection-11"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.A0.D0.B5.D0.B3.D0.B8.D1.81.D1.82.D1.80.D0.B0.D1.86.D0.B8.D1.8F_.D1.84.D0.B0.D0.B1.D1.80.D0.B8.D0.BA"><span class="tocnumber">1.10</span> <span class="toctext"><b>Регистрация фабрик</b></span></a></li>
<li class="toclevel-2 tocsection-12"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#instanceof_.D0.B8_.D1.81.D1.80.D0.B0.D0.B2.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_Class"><span class="tocnumber">1.11</span> <span class="toctext"><b>instanceof и сравнение Class</b></span></a></li>
<li class="toclevel-2 tocsection-13"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.A0.D0.B5.D1.84.D0.BB.D0.B5.D0.BA.D1.81.D0.B8.D1.8F:_.D0.B4.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B0.D1.8F_.D0.B8.D0.BD.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D0.B8.D1.8F_.D0.BE_.D0.BA.D0.BB.D0.B0.D1.81.D1.81.D0.B5"><span class="tocnumber">1.12</span> <span class="toctext"><b>Рефлексия: динамическая информация о классе</b></span></a></li>
<li class="toclevel-2 tocsection-14"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.98.D0.B7.D0.B2.D0.BB.D0.B5.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B8.D0.BD.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D0.B8.D0.B8_.D0.BE_.D0.BC.D0.B5.D1.82.D0.BE.D0.B4.D0.B0.D1.85_.D0.BA.D0.BB.D0.B0.D1.81.D1.81.D0.B0"><span class="tocnumber">1.13</span> <span class="toctext"><b>Извлечение информации о методах класса</b></span></a></li>
<li class="toclevel-2 tocsection-15"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.94.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B5_.D0.BF.D0.BE.D1.81.D1.80.D0.B5.D0.B4.D0.BD.D0.B8.D0.BA.D0.B8"><span class="tocnumber">1.14</span> <span class="toctext"><b>Динамические посредники</b></span></a></li>
<li class="toclevel-2 tocsection-16"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.9E.D0.B1.D1.8A.D0.B5.D0.BA.D1.82.D1.8B_.D1.81_.D0.BD.D0.B5.D0.BE.D0.BF.D1.80.D0.B5.D0.B4.D0.B5.D0.BB.D0.B5.D0.BD.D0.BD.D1.8B.D0.BC_.D1.81.D0.BE.D1.81.D1.82.D0.BE.D1.8F.D0.BD.D0.B8.D0.B5.D0.BC"><span class="tocnumber">1.15</span> <span class="toctext"><b>Объекты с неопределенным состоянием</b></span></a></li>
<li class="toclevel-2 tocsection-17"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.98.D0.BD.D1.82.D0.B5.D1.80.D1.84.D0.B5.D0.B9.D1.81.D1.8B_.D0.B8_.D0.B8.D0.BD.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D0.B8.D1.8F_.D0.BE_.D1.82.D0.B8.D0.BF.D0.B0.D1.85"><span class="tocnumber">1.16</span> <span class="toctext"><b>Интерфейсы и информация о типах</b></span></a></li>
<li class="toclevel-2 tocsection-18"><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#.D0.A0.D0.B5.D0.B7.D1.8E.D0.BC.D0.B5"><span class="tocnumber">1.17</span> <span class="toctext"><b>Резюме</b></span></a></li>
</ul>
</li>
</ul>
</div>

</td></tr></tbody></table>
<h1><span class="mw-headline" id=".D0.98.D0.9D.D0.A4.D0.9E.D0.A0.D0.9C.D0.90.D0.A6.D0.98.D0.AF_.D0.9E_.D0.A2.D0.98.D0.9F.D0.90.D0.A5"><b>ИНФОРМАЦИЯ О ТИПАХ</b></span></h1>
<p>Механизм <i>RTTI</i> (<i>Runtime Type Information</i>) предназначен для получения и использования информации о типах во время выполнения программы.
<i>RTTI</i> освобождает разработчика от необходимости выполнять всю 
работу с типами на стадии компиляции и открывает немало замечательных 
возможностей. Потребность в <i>RTTI</i> вскрывает целый ряд интересных (и зачастую сложных) аспектов объектно-ориентированного проектирования.
</p><p>В этой главе рассматриваются способы получения информации об объектах и классах во время выполнения программы в <i>Java</i>. Существует два механизма получения такой информации: «традиционный» механизм <i>RTTI</i>, подразумевающий, что все типы доступны во время компиляции, а также механизм рефлексии (<i>reflection</i>), применяемый исключительно во время выполнения программы.
</p>
<h2><span class="mw-headline" id=".D0.9D.D0.B5.D0.BE.D0.B1.D1.85.D0.BE.D0.B4.D0.B8.D0.BC.D0.BE.D1.81.D1.82.D1.8C_.D0.B2_.D0.B4.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.BE.D0.BC_.D0.BE.D0.BF.D1.80.D0.B5.D0.B4.D0.B5.D0.BB.D0.B5.D0.BD.D0.B8.D0.B8_.D1.82.D0.B8.D0.BF.D0.BE.D0.B2_.28RTTI.29"><b>Необходимость в динамическом определении типов (<i>RTTI</i>)</b></span></h2>
<p>Рассмотрим хорошо знакомый пример с геометрическими фигурами, 
основанный на полиморфизме. Обобщенным базовым классом является фигура <i><b>Shape</b></i>, а производными классами — окружность <i><b>Circle</b></i>, прямоугольник <i><b>Square</b></i> и треугольник <i><b>Triangle</b></i>.
</p><p><a href="http://wikijava.org.ua/index.php?title=%D0%A4%D0%B0%D0%B9%D0%BB:13.1.png" class="image"><img alt="13.1.png" src="%D0%93%D0%BB%D0%B0%D0%B2%D0%B0%2013_files/13.png" height="271" width="500"></a>
</p><p>Это обычная диаграмма наследования — базовый класс расположен 
вверху, производные классы присоединяются к нему снизу. Обычно при 
разработке объектно-ориентированных программ код по возможности 
манипулирует ссылками на базовый класс (в нашем случае это фигура — <i><b>Shape</b></i>). Если вдруг в программу будет добавлен новый класс (например, производный от фигуры <i><b>Shape</b></i> ромб — <i><b>Rhomboid</b></i>), то код менять не придется. В нашем случае метод <i><b>draw()</b></i> класса является динамически связываемым, поэтому программист-клиент может вызывать этот метод, пользуясь ссылкой базового типа <i><b>Shape</b></i>. Метод <i><b>draw()</b></i>
 переопределяется во всех производных классах, и по природе 
динамического связывания вызов его по ссылке на базовый класс все равно 
даст необходимый результат. Это и есть полиморфизм.
Таким образом, обычно вы создаете объект конкретного класса (<i><b>Circle, Square</b></i> или <i><b>Triangle</b></i>), проводите восходящее преобразование к фигуре <i><b>Shape</b></i> («забывая» точный тип объекта) и используете ссылку на обобщенную фигуру. Реализация иерархии <i><b>Shape</b></i> может выглядеть примерно так:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java5 source-java5"><pre class="de1"><span class="co1">//: typeinfo/Shapes.java</span>
<span class="kw2">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">abstract</span> <span class="kw2">class</span> <span class="kw6">Shape</span> <span class="br0">{</span>
  <span class="kw3">void</span> draw<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw21">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="kw2">this</span> + <span class="st0">".draw()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
  <span class="kw2">abstract</span> <span class="kw2">public</span> <span class="kw21">String</span> toString<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">class</span> Circle <span class="kw2">extends</span> <span class="kw6">Shape</span> <span class="br0">{</span>
  <span class="kw2">public</span> <span class="kw21">String</span> toString<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw2">return</span> <span class="st0">"Circle"</span><span class="sy0">;</span> <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">class</span> Square <span class="kw2">extends</span> <span class="kw6">Shape</span> <span class="br0">{</span>
  <span class="kw2">public</span> <span class="kw21">String</span> toString<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw2">return</span> <span class="st0">"Square"</span><span class="sy0">;</span> <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw2">class</span> Triangle <span class="kw2">extends</span> <span class="kw6">Shape</span> <span class="br0">{</span>
  <span class="kw2">public</span> <span class="kw21">String</span> toString<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw2">return</span> <span class="st0">"Triangle"</span><span class="sy0">;</span> <span class="br0">}</span>
<span class="br0">}</span>	
&nbsp;
<span class="kw2">public</span> <span class="kw2">class</span> Shapes <span class="br0">{</span>
  <span class="kw2">public</span> <span class="kw2">static</span> <span class="kw3">void</span> main<span class="br0">(</span><span class="kw21">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw166">List</span><span class="sy0">&lt;</span><span class="kw6">Shape</span><span class="sy0">&gt;</span> shapeList = <span class="kw46">Arrays</span>.<span class="me1">asList</span><span class="br0">(</span>
      <span class="kw2">new</span> Circle<span class="br0">(</span><span class="br0">)</span>, <span class="kw2">new</span> Square<span class="br0">(</span><span class="br0">)</span>, <span class="kw2">new</span> Triangle<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">for</span><span class="br0">(</span><span class="kw6">Shape</span> shape&nbsp;: shapeList<span class="br0">)</span>
      shape.<span class="me1">draw</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt; 
</p>
<pre>Circle.draw() 
Square.draw() 
Triangle.draw() 
</pre>
<p>&lt;/spoiler&gt;
Метод <i><b>draw()</b></i> базового класса <i><b>Shape</b></i> неявно использует метод <i><b>toString()</b></i> для вывода идентификатора класса, для чего ссылка <i><b>this</b></i> передается методу <i><b>System.out.println()</b></i>
 (обратите внимание: метод toString() объявлен абстрактным, чтобы 
производные классы были обязаны переопределить его и чтобы предотвратить
 создание экземпляров <i><b>Shape</b></i>). Когда этот объект встречается в выражении конкатенации строк, автоматически вызывается его метод <i><b>toString()</b></i> для получения соответствующего строкового представления. Каждый из производных классов переопределяет метод <i><b>toString()</b></i> (из базового класса <i><b>Object</b></i>), чтобы метод <i><b>draw()</b></i> выводил в каждом случае различную информацию.
В данном примере восходящее преобразование происходит во время помещения объекта-фигуры в контейнер <i><b>List&lt;Shape&gt;</b></i>.
 В процессе восходящего преобразования теряется конкретная информация, в
 том числе и точный тип фигур. Контейнеру все равно — он хранит просто 
объекты <i><b>Shape</b></i>.
Когда вы извлекаете из контейнера очередной элемент, контейнер, в котором все элементы хранятся в виде <i><b>Object</b></i>, автоматически преобразует результат обратно к <i><b>Shape</b></i>. Это наиболее основная форма <i>RTTI</i>, поскольку все подобные преобразования в языке <i>Java</i> проверяются на правильность на стадии исполнения. Именно для этого и служит <i>RTTI</i>: во время выполнения программы проверяется истинный тип объекта.
В нашем случае определение типа происходит частично: тип <i><b>Object</b></i> преобразуется к базовому типу фигур <i><b>Shape</b></i>, а не к конкретным типам <i><b>Circle, Square</b></i> или <i><b>Triangle</b></i>. Просто потому, что в данный момент нам известно только то, что кон­тейнер <i><b>List&lt;Shape&gt;</b></i> заполнен фигурами <i><b>Shape</b></i>. Во время компиляции соблюдение этого требования обеспечивается контейнером и системой параметризованных типов <i>Java</i>, а при выполнении оно подтверждается успешным преобразованием типов.
Теперь в действие вступает полиморфизм — для каждой фигуры Shape вызывается свой метод <i><b>draw()</b></i>, в зависимости от того, окружность это (<i><b>Circle</b></i>), прямоугольник (<i><b>Square</b></i>) или треугольник (<i><b>Triangle</b></i>).
 И в основном именно так и должно быть; основная часть кода не должна 
зависеть от точного типа объекта, она оперирует с универсальным 
представлением целого семейства объектов (в нашем случае это фигура (<i><b>Shape</b></i>)).
 Такой подход упрощает написание программы, а впоследствии ее чтение и 
сопровождение. По этой причине полиморфизм часто используется при 
написании объектно-ориентированных программ.
Но что, если у вас имеется не совсем обычная задача, для успешного 
решения которой необходимо узнать точный тип объекта, располагая только 
ссылкой на базовый тип? Допустим, пользователи программы с фигурами 
хотят выделить определенные фигуры (скажем, все треугольники) на экране 
фиолетовым цветом. При помощи <i>RTTI</i> можно узнать точный тип объекта, на который указывает ссылка базового типа <i><b>Shape</b></i>.
</p>
<h2><span class="mw-headline" id=".D0.9E.D0.B1.D1.8A.D0.B5.D0.BA.D1.82_Class"><b>Объект Class</b></span></h2>
<p>Чтобы понять, как работает <i>RTTI</i> в <i>Java</i>, необходимо 
знать, каким образом хранится информация о типе во время выполнения 
программы. Для этой цели используется специальный объект типа <i><b>Class</b></i>, который и содержит описание класса. Объект Class используется при создании всех «обыкновенных» объектов любой программы.
Каждый класс, задействованный в программе, представлен своим объектом <i><b>Class</b></i>. Иначе говоря, при написании и последующей компиляции нового класса для него создается объект <i><b>Class</b></i> (который затем сохраняется в одноименном файле с расширением <i><b>.class</b></i>). Для создания объекта этого класса виртуальная машина <i>Java</i> <i>JVM</i>),
 исполняющая программу, использует подсистему, называемую загрузчиком 
классов.
Подсистема загрузчиков классов в действительности состоит из цепочки 
загрузчиков классов, но только основной загрузчик является частью 
реализации <i>JVM</i>. Основной загрузчик классов загружает так называемые доверенные классы, в том числе классы <i>Java</i>
 API, с локального диска. Обычно включать дополнительные загрузчики 
классов в цепочку не требуется, но в особых ситуациях (например, при 
загрузке классов для поддержки приложений веб-сервера или при загрузке 
классов по сети) существует возможность подключения дополнительных 
загрузчиков.
Все классы загружаются в <i>JVM</i> динамически, при первом использовании класса. Таким образом, программа на <i>Java</i> никогда не бывает полностью загружена до начала своего выполнения, и в этом отношении <i>Java</i>
 отличается от многих традиционных языков. Динамическая загрузка 
открывает возможности, недоступные или трудно реализуемые в языках со 
статической загрузкой вроде <i>C++</i>.
Сначала <i>JVM</i> проверяет, загружен ли объект <i><b>Class</b></i> для этого нового класса. При отрицательном результате <i>JVM</i> ищет подходящий файл <i><b>.class</b></i>
 и подгружает его (а дополнительный загрузчик, например, может 
подгружать байт-код из базы данных). Загруженный код класса проходит 
проверку на целостность и на отсутствие некорректного байт-кода <i>Java</i> (одна из «линий защиты» в <i>Java</i>).
После того как объект <i><b>Class</b></i> для определенного типа будет 
помещен в память, в дальнейшем он используется при создании всех 
объектов этого типа. Следующая программа проясняет сказанное:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/SweetShop.java</span>
<span class="co1">//  Проверка процесса загрузки классов</span>
<span class="kw1">import</span> <span class="co2">static</span> net.<span class="me1">mindview</span>.<span class="me1">util</span>.<span class="me1">Print</span>.<span class="sy0">*;</span>
&nbsp;
<span class="kw1">class</span> Candy <span class="br0">{</span>
  <span class="kw1">static</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"Загрузка класса Candy"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> Gum <span class="br0">{</span>
  <span class="kw1">static</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"Загрузка класса Gum"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> Cookie <span class="br0">{</span>
  <span class="kw1">static</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"Загрузка класса Cookie"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> SweetShop <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>	
    print<span class="br0">(</span><span class="st0">"в методе main()"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">new</span> Candy<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"После создания объекта Candy"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">try</span> <span class="br0">{</span>
      <span class="kw1">Class</span>.<span class="me1">forName</span><span class="br0">(</span><span class="st0">"Gum"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span> <span class="kw1">catch</span><span class="br0">(</span><span class="kw3">ClassNotFoundException</span> e<span class="br0">)</span> <span class="br0">{</span>
      print<span class="br0">(</span><span class="st0">"Класс Gum не найден"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
    print<span class="br0">(</span><span class="st0">"После вызова метода Class.forName(<span class="es0">\"</span>Gum<span class="es0">\"</span>)"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">new</span> Cookie<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"После создания объекта Cookie"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>в методе main()
Загрузка класса Candy 
После создания объекта Candy 
Загрузка класса Gum
После вызова метода Class.forName("Gum") 
Загрузка класса Cookie 
После создания объекта Cookie
</pre>
<p>&lt;/spoiler&gt; 
В каждом из классов <i><b>Candy, Gum</b></i> и <i><b>Cookie</b></i> 
присутствует статический блок, который отрабатывает один раз, при первой
 загрузке класса. При выполнении этого блока выводится сообщение, 
говорящее о том, какой класс загружается. В методе <i><b>main()</b></i> создание объектов классов <i><b>Candy, Gum</b></i> и <i><b>Cookie</b></i>
 чередуется с выводом на экран вспомогательных сообщений, по которым 
можно оценить, в какой момент загружается тот или иной класс.
Из результата работы программы мы видим, что объект Class загружается 
только при непосредственной необходимости, а статическая инициализация 
производится при загрузке этого объекта.
Особенно интересно выглядит строка программы
</p>
<pre>Class.forName("Gum");
</pre>
<p>Все объекты <i><b>Class</b></i> принадлежат классу <i><b>Class</b></i>. Объект <i><b>Class</b></i>
 ничем принципиально не отличается от других объектов, поэтому вы можете
 выполнять операции со ссылкой на него (именно так и поступает загрузчик
 классов). Один из способов получения ссылки на объект <i><b>Class</b></i> заключается в вызове метода <i><b>forName()</b></i>, которому передается строка (<i><b>String</b></i>) с именем класса (следите за правильностью написания и регистром символов!). Метод возвращает ссылку на объект <i><b>Class</b></i>, которая в данном примере нам не нужна; метод <i><b>Class.forName()</b></i> вызывался ради побочного эффекта, то есть загрузки класса <i><b>Gum</b></i>, если он еще не в памяти. В процессе загрузки выполняется <i><b>static</b></i>-инициализатор класса <i><b>Gum</b></i>.
Если бы в рассмотренном примере метод <i><b>Class.forName()</b></i> сработал неудачно (не смог бы найти класс, который вы хотели загрузить), он возбудил бы исключение <i><b>ClassNotFoundException</b></i>.
 Здесь мы просто сообщаем о проблеме и двигаемся дальше, однако в более 
совершенной программе можно было бы попытаться исправить ошибку в 
обработчике исключения.
Чтобы использовать информацию <i>RTTI</i> на стадии исполнения, прежде всего необходимо получить ссылку на подходящий объект <i><b>Class</b></i>. Один из способов — вызов метода <i><b>Class.forName()</b></i>
 — удобен тем, что вам не потребуется уже сущест­вующий объект нужного 
типа. Впрочем, если такой объект уже существует, для получения ссылки на
 его объект <i><b>Class</b></i> можно вызвать метод <i><b>getClass()</b></i>, определенный в корневом классе <i><b>Object</b></i>. Метод возвращает объект <i><b>Class</b></i>, представляющий фактический тип объекта. Класс <i><b>Class</b></i> содержит немало интересных методов, продемонстрированных в следующем примере:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/toys/ToyTest.java</span>
<span class="co1">// Testing class Class.</span>
<span class="kw1">package</span> <span class="co2">typeinfo.toys</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">static</span> net.<span class="me1">mindview</span>.<span class="me1">util</span>.<span class="me1">Print</span>.<span class="sy0">*;</span>
&nbsp;
<span class="kw1">interface</span> HasBatteries <span class="br0">{</span><span class="br0">}</span>
<span class="kw1">interface</span> Waterproof <span class="br0">{</span><span class="br0">}</span>
<span class="kw1">interface</span> Shoots <span class="br0">{</span><span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> Toy <span class="br0">{</span>
  <span class="co1">// Закомментируйте следующий далее конструктор по </span>
  <span class="co1">// умолчанию, тогда в строке с пометкой (*1*) </span>
  <span class="co1">// возникнет ошибка NoSuchMethodError</span>
  Toy<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span>
  Toy<span class="br0">(</span><span class="kw4">int</span> i<span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> FancyToy <span class="kw1">extends</span> Toy
<span class="kw1">implements</span> HasBatteries, Waterproof, Shoots <span class="br0">{</span>
  FancyToy<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> ToyTest <span class="br0">{</span>
  <span class="kw1">static</span> <span class="kw4">void</span> printInfo<span class="br0">(</span><span class="kw1">Class</span> cc<span class="br0">)</span> <span class="br0">{</span>
    print<span class="br0">(</span><span class="st0">"Имя класса: "</span> <span class="sy0">+</span> cc.<span class="me1">getName</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">+</span>
      <span class="st0">" это интерфейс?["</span> <span class="sy0">+</span> cc.<span class="me1">isInterface</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">+</span> <span class="st0">"]"</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"Простое имя: "</span> <span class="sy0">+</span> cc.<span class="me1">getSimpleName</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"Каноническое имя: "</span> <span class="sy0">+</span> cc.<span class="me1">getCanonicalName</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">Class</span> c <span class="sy0">=</span> <span class="kw2">null</span><span class="sy0">;</span>
    <span class="kw1">try</span> <span class="br0">{</span>
      c <span class="sy0">=</span> <span class="kw1">Class</span>.<span class="me1">forName</span><span class="br0">(</span><span class="st0">"typeinfo.toys.FancyToy"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span> <span class="kw1">catch</span><span class="br0">(</span><span class="kw3">ClassNotFoundException</span> e<span class="br0">)</span> <span class="br0">{</span>
      print<span class="br0">(</span><span class="st0">"He найден класс FancyToy"</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="kw3">System</span>.<span class="me1">exit</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
    printInfo<span class="br0">(</span>c<span class="br0">)</span><span class="sy0">;</span>	
    <span class="kw1">for</span><span class="br0">(</span><span class="kw1">Class</span> face <span class="sy0">:</span> c.<span class="me1">getInterfaces</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
      printInfo<span class="br0">(</span>face<span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">Class</span> up <span class="sy0">=</span> c.<span class="me1">getSuperclass</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">Object</span> obj <span class="sy0">=</span> <span class="kw2">null</span><span class="sy0">;</span>
    <span class="kw1">try</span> <span class="br0">{</span>
      <span class="co1">// Необходим конструктор по умолчанию: </span>
      obj <span class="sy0">=</span> up.<span class="me1">newInstance</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span> <span class="kw1">catch</span><span class="br0">(</span><span class="kw3">InstantiationException</span> e<span class="br0">)</span> <span class="br0">{</span>
      print<span class="br0">(</span><span class="st0">"He удалось создать объект"</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="kw3">System</span>.<span class="me1">exit</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span> <span class="kw1">catch</span><span class="br0">(</span><span class="kw3">IllegalAccessException</span> e<span class="br0">)</span> <span class="br0">{</span>
      print<span class="br0">(</span><span class="st0">"Нет доступа"</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="kw3">System</span>.<span class="me1">exit</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
    printInfo<span class="br0">(</span>obj.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>Имя класса typeinfo toys FancyToy это интерфейс? [false]
Простое имя FancyToy
Каноническое имя- typeinfo.toys FancyToy
Имя класса typeinfo toys HasBatteries это интерфейс? [true]
Простое имя HasBatteries
Каноническое имя: typeinfo toys HasBatteries
Имя класса typeinfo toys Waterproof это интерфейс? [true]
Простое имя. Waterproof
Каноническое имя typeinfo toys Waterproof
Имя класса, typeinfo.toys Shoots это интерфейс? [true]
Простое имя: Shoots
Каноническое имя: typeinfo.toys Shoots
Имя класса: typeinfo.toys Toy это интерфейс? [false]
Простое имя: Toy
Каноническое имя typeinfo.toys.Toy 
</pre>
<p>&lt;/spoiler&gt;
Класс <i><b>FancyToy</b></i>, производный от <i><b>Toy</b></i>, реализует несколько интерфейсов: <i><b>HasBatteries, Waterproof</b></i> и <i><b>Shoots</b></i>. В методе <i><b>main()</b></i> создается ссылка на объект <i><b>Class</b></i> для класса <i><b>FancyToy</b></i>, для этого в подходящем блоке <i><b>try</b></i> вызывается метод <i><b>forName()</b></i>. Обратите внимание на необходимость использования полного имени (с именем пакета) в строке, передаваемой <i><b>forName()</b></i>.
Метод <i><b>printInfo()</b></i> использует <i><b>getName()</b></i> для получения полного имени класса и методы <i><b>getSimpleName()</b></i> и <i><b>getCanonicalName()</b></i> (появившиеся в <i>Java</i> <i>SE5</i>), возвращающие имя без пакета и полное имя соответственно. Метод <i><b>isInterface()</b></i> проверяет, представляет ли объект <i><b>Class</b></i> интерфейс. Таким образом, по объекту <i><b>Class</b></i> можно узнать практически все, что может потребоваться узнать о типе.
Метод <i><b>Class.getInterfaces()</b></i> возвращает массив объектов <i><b>Class</b></i>, представляющих интерфейсы, реализованные объектом <i><b>Class</b></i>. Метод <i><b>getSuperclass()</b></i> возвращает непосредственный (то есть ближайший) базовый класс для объекта <i><b>Class</b></i>.
Метод <i><b>newInstance()</b></i> фактически реализует «виртуальный 
конструктор». Вы как бы говорите: «Я не знаю ваш точный тип, так что 
создайте себя самостоятельно». В рассмотренном примере ссылка <i><b>up</b></i> просто указывает на объект <i><b>Class</b></i>, больше никакой информации о типе у вас нет. Поэтому при создании нового экземпляра методом <i><b>newInstance()</b></i> вы получаете ссылку на обобщенный объект <i><b>Object</b></i>. Однако полученная ссылка на самом деле указывает на объект <i><b>Toy</b></i>. Следовательно, перед посылкой сообщений, характерных для класса <i><b>Toy</b></i>, придется провести нисходящее преобразование. Вдобавок объект, созданный с помощью метода <i><b>newInstance()</b></i>,
 обязан определить конструктор по умолчанию. Позднее в этой главе будет 
показано, как динамически создать объект класса любым конструктором с 
использованием механизма рефлексии <i>Java</i>.
</p>
<h2><span class="mw-headline" id=".D0.9B.D0.B8.D1.82.D0.B5.D1.80.D0.B0.D0.BB.D1.8B_class"><b>Литералы class</b></span></h2>
<p>В <i>Java</i> существует еще один способ получения ссылок на объект <i><b>Class</b></i> — посредством литерала <i><b>class</b></i>. В предыдущей программе получение ссылки выглядело бы так:
</p>
<pre>FancyToy.class:
</pre>
<p>Такой способ не только проще, но еще и безопасней, поскольку проверка
 осуществляется еще во время компиляции. К тому же он не требует вызова <i><b>forName()</b></i>, а значит, является более эффективным.
Литералы <i><b>class</b></i> работают со всеми обычными классами, так же
 как и с интерфейсами, массивами и даже с примитивами. Вдобавок во всех 
классах-обертках для примитивных типов имеется поле с именем <i><b>TYPE</b></i>. Это поле содержит ссылку на объект <i><b>Class</b></i> для ассоциированного с ним простейшего типа, как показано в табл. 13.1.
Таблица 13.1. Альтернативное обозначение объекта Class с помощью литералов
Литерал	
Ссылка на объект Class
</p>
<pre>boolean.class	Boolean.TYPE
char.class	Character.TYPE
byte.class	Byte.TYPE
short.class	Short.TYPE
int.class	Integer.TYPE
long.class	Long.TYPE
float.class	Float.TYPE
double.class	Double.TYPE
void.class	Void.TYPE
</pre>
<p>Хотя эти версии эквивалентны, я предпочитаю использовать синтаксис <i><b>.class</b></i>, так как он лучше сочетается с обычными классами.
</p><p>Интересно заметить, что создание ссылки на объект <i><b>Class</b></i> с использованием записи <i><b>.class</b></i> не приводит к автоматической инициализации объекта <i><b>Class</b></i>. Подготовка класса к использованию состоит из трех этапов:
</p><p><br>
</p>
<hr>
<ul>
<li><span style="color:#800000"><b>Загрузка</b> — выполняется загрузчиком классов. Последний находит байт- код и создает на его основе объект Class.</span>
</li>
</ul>
<ul>
<li><span style="color:#800000"><b>Компоновка</b> — в фазе компоновки 
проверяется байт-код класса, выделяется память для статических полей, и 
при необходимости разрешаются все ссылки на классы, созданные этим 
классом.</span>
</li>
</ul>
<ul>
<li><span style="color:#800000"><b>Инициализация</b> — если у класса 
имеется суперкласс, происходит его инициализация, выполняются 
статические инициализаторы и блоки статической инициализации.</span>
</li>
</ul>
<hr>
<p>Инициализация откладывается до первой ссылки на статический метод 
(конструкторы являются статическими методами) или на неконстантное 
статическое поле:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/ClassInitialization.java</span>
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">class</span> Initable <span class="br0">{</span>
  <span class="kw1">static</span> <span class="kw1">final</span> <span class="kw4">int</span> staticFinal <span class="sy0">=</span> <span class="nu0">47</span><span class="sy0">;</span>
  <span class="kw1">static</span> <span class="kw1">final</span> <span class="kw4">int</span> staticFinal2 <span class="sy0">=</span>
    ClassInitialization.<span class="me1">rand</span>.<span class="me1">nextInt</span><span class="br0">(</span><span class="nu0">1000</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw1">static</span> <span class="br0">{</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"Initializing Initable"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> Initable2 <span class="br0">{</span>
  <span class="kw1">static</span> <span class="kw4">int</span> staticNonFinal <span class="sy0">=</span> <span class="nu0">147</span><span class="sy0">;</span>
  <span class="kw1">static</span> <span class="br0">{</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"Initializing Initable2"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> Initable3 <span class="br0">{</span>
  <span class="kw1">static</span> <span class="kw4">int</span> staticNonFinal <span class="sy0">=</span> <span class="nu0">74</span><span class="sy0">;</span>
  <span class="kw1">static</span> <span class="br0">{</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"Initializing Initable3"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> ClassInitialization <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw3">Random</span> rand <span class="sy0">=</span> <span class="kw1">new</span> <span class="kw3">Random</span><span class="br0">(</span><span class="nu0">47</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="kw1">throws</span> <span class="kw3">Exception</span> <span class="br0">{</span>
    <span class="kw1">Class</span> initable <span class="sy0">=</span> Initable.<span class="kw1">class</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"After creating Initable ref"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">// Does not trigger initialization:</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>Initable.<span class="me1">staticFinal</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">// Does trigger initialization:</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>Initable.<span class="me1">staticFinal2</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">// Does trigger initialization:</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>Initable2.<span class="me1">staticNonFinal</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">Class</span> initable3 <span class="sy0">=</span> <span class="kw1">Class</span>.<span class="me1">forName</span><span class="br0">(</span><span class="st0">"Initable3"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"After creating Initable3 ref"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>Initable3.<span class="me1">staticNonFinal</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>After creating Initable ref
47
Initializing Initable
258
Initializing Initable2
147
Initializing Initable3
After creating Initable3 ref
74
</pre>
<p>&lt;/spoiler&gt;
По сути, инициализация откладывается настолько, насколько это возможно. 
Из результатов видно, что простое использование синтаксиса <i><b>.class</b></i> для получения ссылки на класс не приводит к выполнению инициализации. С другой стороны, вызов <i><b>Class.forNames()</b></i> немедленно инициализирует класс для получения ссылки на <i><b>Class</b></i>, как мы видим на примере <i><b>initable3</b></i>.
</p>
<h2><span class="mw-headline" id=".D0.9F.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D0.B8.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.BD.D1.8B.D0.B5_.D1.81.D1.81.D1.8B.D0.BB.D0.BA.D0.B8"><b>Параметризованные ссылки</b></span></h2>
<p>Объект <i><b>Class</b></i> используется для создания экземпляров 
класса и содержит полный код методов этих экземпляров. Кроме того, в нем
 содержатся статические члены класса. Таким образом, ссылка на <i><b>Class</b></i> подразумевает точный тип того, на что она указывает — на объект класса <i><b>Class</b></i>.
Однако проектировщики <i>Java</i> <i>SE5</i> решили предоставить возможность уточнения записи посредством ограничения типа объекта <i><b>Class</b></i>,
 на который может указывать ссылка; для этой цели применяется синтаксис 
параметризации. В следующем примере верны оба варианта синтаксиса:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/GenericClassReferences.java</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> GenericClassReferences <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">Class</span> intClass <span class="sy0">=</span> <span class="kw4">int</span>.<span class="kw1">class</span><span class="sy0">;</span>
    Class<span class="sy0">&lt;</span>Integer<span class="sy0">&gt;</span> genericIntClass <span class="sy0">=</span> <span class="kw4">int</span>.<span class="kw1">class</span><span class="sy0">;</span>
    genericIntClass <span class="sy0">=</span> <span class="kw3">Integer</span>.<span class="kw1">class</span><span class="sy0">;</span> <span class="co1">// To же самое</span>
    intClass <span class="sy0">=</span> <span class="kw4">double</span>.<span class="kw1">class</span><span class="sy0">;</span>
    <span class="co1">// genericIntClass = double.class; // Недопустимо</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>Если обычная ссылка на класс может быть связана с любым объектом <i><b>Class</b></i>,
 параметризованная ссылка может связываться только с объектами типа, 
указанного при ее объявлении. Синтаксис параметризации позволяет 
компилятору выполнить дополнительную проверку типов.
</p><p><br>
</p>
<h2><span class="mw-headline" id=".D0.9D.D0.BE.D0.B2.D1.8B.D0.B9_.D1.81.D0.B8.D0.BD.D1.82.D0.B0.D0.BA.D1.81.D0.B8.D1.81_.D0.BF.D1.80.D0.B5.D0.BE.D0.B1.D1.80.D0.B0.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F"><b>Новый синтаксис преобразования</b></span></h2>
<p>В <i>Java</i> <i>SE5</i> также появился новый синтаксис преобразования ссылок на <i><b>Class</b></i>, основанный на методе <i><b>cast()</b></i>:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/ClassCasts.java</span>
<span class="kw1">class</span> Building <span class="br0">{</span><span class="br0">}</span>
<span class="kw1">class</span> House <span class="kw1">extends</span> Building <span class="br0">{</span><span class="br0">}</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> ClassCasts <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
    Building b <span class="sy0">=</span> <span class="kw1">new</span> House<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    Class<span class="sy0">&lt;</span>House<span class="sy0">&gt;</span> houseType <span class="sy0">=</span> House.<span class="kw1">class</span><span class="sy0">;</span>
    House h <span class="sy0">=</span> houseType.<span class="me1">cast</span><span class="br0">(</span>b<span class="br0">)</span><span class="sy0">;</span>
    h <span class="sy0">=</span> <span class="br0">(</span>House<span class="br0">)</span>b<span class="sy0">;</span> <span class="co1">// ... or just do this.</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>Метод <i><b>cast()</b></i> получает объект-аргумент и преобразует его к типу ссылки на <i><b>Class</b></i>.
 Конечно, при взгляде на приведенный код может показаться, что он 
занимает слишком много места по сравнению с последней строкой <i><b>main()</b></i>,
 которая делает то же самое. Новый синтаксис преобразования полезен в 
тех ситуациях, когда обычное преобразование невозможно. Обычно это 
происходит тогда, когда при написании параметризованного кода (см. 
далее) ссылка на <i><b>Class</b></i> сохраняется для преобразования в будущем. Подобные ситуации встречаются крайне редко — во всей библиотеке <i>Java</i> <i>SE5</i> <i><b>cast()</b></i> используется всего один раз (в <i><b>com.sun.mirror.util.DeclarationFilter</b></i>).
Другая новая возможность — <i><b>Class.asSubclass()</b></i> — вообще не встречается в библиотеке <i>Java</i> <i>SE5</i>. Этот метод позволяет преобразовать объект класса к более конкретному типу.
</p><p><br>
</p>
<h2><span class="mw-headline" id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.BF.D0.B5.D1.80.D0.B5.D0.B4_.D0.BF.D1.80.D0.B8.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5.D0.BC_.D1.82.D0.B8.D0.BF.D0.BE.D0.B2"><b>Проверка перед приведением типов</b></span></h2>
<p>Итак, мы рассмотрели следующие формы <i>RTTI</i>:
</p>
<hr>
<ul>
<li><span style="color:#800000">Классическое преобразование; аналог выражения «(<i><b>Shape</b></i>)»,
 которое проверяет, «законно» ли приведение типов в данной ситуации, и в
 случае неверного преобразования возбуждает исключение <i><b>ClassCastException</b></i>.</span>
</li>
<li><span style="color:#800000">Объект <i><b>Class</b></i>, представляющий тип вашего объекта. К объекту <i><b>Class</b></i> можно обращаться для получения полезной информации во время выполнения программы.</span>
</li>
</ul>
<hr>
<p>В языке <i>C++</i> классическая форма типа «(<i><b>Shape</b></i>)» вообще не задействует <i>RTTI</i>. Она просто сообщает компилятору, что необходимо обращаться с объектом как с новым типом. В языке <i>Java</i>,
 который при приведении проверяет соответствие типов, такое 
преобразование часто называют «безопасным нисходящим приведением типов».
 Слово «нисходящее» используется в силу традиций, сложившихся в практике
 составления диаграмм наследования. Если приведение окружности <i><b>Circle</b></i> к фигуре <i><b>Shape</b></i> является восходящим, то приведение фигуры <i><b>Shape</b></i> к окружности <i><b>Circle</b></i> является, соответственно, нисходящим. Поскольку компилятор знает, что <i><b>Circle</b></i> является частным случаем <i><b>Shape</b></i>, он позволяет использовать «восходящее» присваивание без явного преобразования типа. Тем не менее, получив некий объект <i><b>Shape</b></i>, компилятор не может быть уверен в том, что он получил: то ли действительно <i><b>Shape</b></i>, то ли один из производных типов (<i><b>Circle, Square</b></i> или <i><b>Triangle</b></i>). На стадии компиляции он видит только <i><b>Shape</b></i> и поэтому не позволит использовать «нисходящее» присваивание без явного преобразования типа.
</p><p>Существует и третья форма <i>RTTI</i> в <i>Java</i> — ключевое слово <i><b>instanceof</b></i>, которое проверяет, является ли объект экземпляром заданного типа. Результат возвращается в логическом (<i><b>boolean</b></i>) формате, поэтому вы просто «задаете» вопрос в следующей форме:
</p>
<pre>іf(х instanceof Dog) ((Dog)x).bark().
</pre>
<p>Команда <i><b>if</b></i> сначала проверяет, принадлежит ли объект к классу <i><b>Dog</b></i>, и только после этого выполняет приведение объекта к типу <i><b>Dog</b></i>. Настоятельно рекомендуется использовать ключевое слово <i><b>instanceof</b></i>
 перед проведением нисходящего преобразования, особенно при недостатке 
информации о точном типе объекта; иначе возникает опасность исключения <i><b>ClassCastException</b></i>.
Обычно проводится поиск одного определенного типа (например, поиск 
треугольников среди прочих фигур), но с помощью ключевого слова <i><b>instanceof</b></i> легко можно идентифицировать все типы объекта. Предположим, что у нас есть иерархия классов для описания домашних животных <i><b>Pet</b></i> (и их владельцев — эта особенность пригодится нам в более позднем примере). Каждое существо (<i><b>Individual</b></i>) в этой иерархии обладает идентификатором <i><b>id</b></i> и необязательным именем. 
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/pets/Individual.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> Individual <span class="kw1">implements</span> Comparable<span class="sy0">&lt;</span>Individual<span class="sy0">&gt;</span> <span class="br0">{</span>
  <span class="kw1">private</span> <span class="kw1">static</span> <span class="kw4">long</span> counter <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
  <span class="kw1">private</span> <span class="kw1">final</span> <span class="kw4">long</span> id <span class="sy0">=</span> counter<span class="sy0">++;</span>
  <span class="kw1">private</span> <span class="kw3">String</span> name<span class="sy0">;</span>
  <span class="kw1">public</span> Individual<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">this</span>.<span class="me1">name</span> <span class="sy0">=</span> name<span class="sy0">;</span> <span class="br0">}</span>
  <span class="co1">// 'name' is optional:</span>
  <span class="kw1">public</span> Individual<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw3">String</span> toString<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">return</span> getClass<span class="br0">(</span><span class="br0">)</span>.<span class="me1">getSimpleName</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">+</span>
      <span class="br0">(</span>name <span class="sy0">==</span> <span class="kw2">null</span> <span class="sy0">?</span> <span class="st0">""</span> <span class="sy0">:</span> <span class="st0">" "</span> <span class="sy0">+</span> name<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">long</span> id<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> id<span class="sy0">;</span> <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">boolean</span> equals<span class="br0">(</span><span class="kw3">Object</span> o<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">return</span> o <span class="kw1">instanceof</span> Individual <span class="sy0">&amp;&amp;</span>
      id <span class="sy0">==</span> <span class="br0">(</span><span class="br0">(</span>Individual<span class="br0">)</span>o<span class="br0">)</span>.<span class="me1">id</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">int</span> hashCode<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw4">int</span> result <span class="sy0">=</span> <span class="nu0">17</span><span class="sy0">;</span>
    <span class="kw1">if</span><span class="br0">(</span>name <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">)</span>
      result <span class="sy0">=</span> <span class="nu0">37</span> <span class="sy0">*</span> result <span class="sy0">+</span> name.<span class="me1">hashCode</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    result <span class="sy0">=</span> <span class="nu0">37</span> <span class="sy0">*</span> result <span class="sy0">+</span> <span class="br0">(</span><span class="kw4">int</span><span class="br0">)</span>id<span class="sy0">;</span>
    <span class="kw1">return</span> result<span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">int</span> compareTo<span class="br0">(</span>Individual arg<span class="br0">)</span> <span class="br0">{</span>
    <span class="co1">// Compare by class name first:</span>
    <span class="kw3">String</span> first <span class="sy0">=</span> getClass<span class="br0">(</span><span class="br0">)</span>.<span class="me1">getSimpleName</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">String</span> argFirst <span class="sy0">=</span> arg.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getSimpleName</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw4">int</span> firstCompare <span class="sy0">=</span> first.<span class="me1">compareTo</span><span class="br0">(</span>argFirst<span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">if</span><span class="br0">(</span>firstCompare <span class="sy0">!=</span> <span class="nu0">0</span><span class="br0">)</span>
    <span class="kw1">return</span> firstCompare<span class="sy0">;</span>
    <span class="kw1">if</span><span class="br0">(</span>name <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">&amp;&amp;</span> arg.<span class="me1">name</span> <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">)</span> <span class="br0">{</span>
      <span class="kw4">int</span> secondCompare <span class="sy0">=</span> name.<span class="me1">compareTo</span><span class="br0">(</span>arg.<span class="me1">name</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="kw1">if</span><span class="br0">(</span>secondCompare <span class="sy0">!=</span> <span class="nu0">0</span><span class="br0">)</span>
        <span class="kw1">return</span> secondCompare<span class="sy0">;</span>
    <span class="br0">}</span>
    <span class="kw1">return</span> <span class="br0">(</span>arg.<span class="me1">id</span> <span class="sy0">&lt;</span> id <span class="sy0">?</span> <span class="sy0">-</span><span class="nu0">1</span> <span class="sy0">:</span> <span class="br0">(</span>arg.<span class="me1">id</span> <span class="sy0">==</span> id <span class="sy0">?</span> <span class="nu0">0</span> <span class="sy0">:</span> <span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>В данный момент код <i><b>Individual</b></i> нас не интересует — достаточно знать, что объект можно создавать с именем или без, и у каждого объекта <i><b>Individual</b></i> имеется метод <i><b>id()</b></i>, возвращающий уникальный идентификатор. Также имеется метод <i><b>toString()</b></i>; если имя не указано, <i><b>toString()</b></i> выдает имя типа. Иерархия классов, производных от <i><b>Individual</b></i>:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Person.java </span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> Person <span class="kw1">extends</span> Individual <span class="br0">{</span>
    <span class="kw1">public</span> Person<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
 <span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Pet.java </span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> Pet <span class="kw1">extends</span> Individual <span class="br0">{</span>
    <span class="kw1">public</span> Pet<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
    <span class="kw1">public</span> Pet <span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
 <span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Dog.java </span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> Dog <span class="kw1">extends</span> Pet <span class="br0">{</span>
    <span class="kw1">public</span> Dog<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
    <span class="kw1">public</span> Dog<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
 <span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Cat.java </span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> Cat <span class="kw1">extends</span> Pet <span class="br0">{</span>
    <span class="kw1">public</span> Cat<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
    <span class="kw1">public</span> Cat<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span> 
 <span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Rodent.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> Rodent <span class="kw1">extends</span> Pet <span class="br0">{</span>
     <span class="kw1">public</span> Rodent<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
    <span class="kw1">public</span> Rodent<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
 <span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Pug.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
<span class="kw1">public</span> <span class="kw1">class</span> Pug <span class="kw1">extends</span> Dog <span class="br0">{</span>
    <span class="kw1">public</span> Pug<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
    <span class="kw1">public</span> Pug<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
<span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Mutt.java </span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> Mutt <span class="kw1">extends</span> Dog <span class="br0">{</span>
    <span class="kw1">public</span> Mutt<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
    <span class="kw1">public</span> Mutt<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
 <span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/EgyptianMau.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> EgyptianMau <span class="kw1">extends</span> Cat <span class="br0">{</span> 
    <span class="kw1">public</span> EgyptianMau<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="kw1">public</span> EgyptianMau<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
 <span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Manx.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> Manx <span class="kw1">extends</span> Cat <span class="br0">{</span>
    <span class="kw1">public</span> Manx<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="kw1">public</span> Manx<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
 <span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Cymric.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> Cymric <span class="kw1">extends</span> Manx <span class="br0">{</span>
    <span class="kw1">public</span> Cymric<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
    <span class="kw1">public</span> Cymric<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
 <span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Rat.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> Rat <span class="kw1">extends</span> Rodent <span class="br0">{</span>
    <span class="kw1">public</span> Rat<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
    <span class="kw1">public</span> Rat<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
 <span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Mouse.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> Mouse <span class="kw1">extends</span> Rodent <span class="br0">{</span>
    <span class="kw1">public</span> Mouse<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="kw1">public</span> Mouse<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
 <span class="br0">}</span></pre></div></div>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/Hamster.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">class</span> Hamster <span class="kw1">extends</span> Rodent <span class="br0">{</span>
    <span class="kw1">public</span> Hamster<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span>name<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="kw1">public</span> Hamster<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">super</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
 <span class="br0">}</span></pre></div></div>
<p>Затем нам понадобятся средства для создания случайных типов <i><b>Pet</b></i>, а для удобства — массивов и списков (<i><b>List</b></i>) с элементами <i><b>Pet</b></i>. Чтобы этот инструментарий мог «пережить» несколько разных реализаций, мы определим его в виде абстрактного класса:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">// typeinfo/pets/PetCreator java </span>
<span class="co1">// Создание случайных последовательностей Pet</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span> 
&nbsp;
<span class="kw1">public</span> <span class="kw1">abstract</span> <span class="kw1">class</span> PetCreator <span class="br0">{</span>
    <span class="co1">//инициализация генератора случайных чисел</span>
<span class="kw1">private</span> <span class="kw3">Random</span> rand <span class="sy0">=</span> <span class="kw1">new</span> <span class="kw3">Random</span><span class="br0">(</span><span class="nu0">47</span><span class="br0">)</span><span class="sy0">;</span> 
    <span class="co1">//абстрактный метод возвращает список возможных типов(классов) животных </span>
<span class="kw1">public</span> <span class="kw1">abstract</span> List<span class="sy0">&lt;</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Pet<span class="sy0">&gt;&gt;</span> getTypes<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
&nbsp;
<span class="kw1">public</span> Pet randomPet<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span> <span class="co1">// Создание одного случайного объекта Pet </span>
    <span class="co1">// генерация случайного номера в диапазоне списка классов животных</span>
    <span class="kw4">int</span> n <span class="sy0">=</span> rand.<span class="me1">nextInt</span><span class="br0">(</span>getTypes<span class="br0">(</span><span class="br0">)</span>.<span class="me1">size</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">try</span> <span class="br0">{</span><span class="co1">//создание нового объекта для класса с данным номером в списке классов </span>
        <span class="kw1">return</span> getTypes<span class="br0">(</span><span class="br0">)</span>.<span class="me1">get</span><span class="br0">(</span>n<span class="br0">)</span>.<span class="me1">newInstance</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
    <span class="kw1">catch</span><span class="br0">(</span> <span class="kw3">InstantiationException</span> e<span class="br0">)</span> <span class="br0">{</span><span class="kw1">throw</span> <span class="kw1">new</span> <span class="kw3">RuntimeException</span><span class="br0">(</span>e<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
    <span class="kw1">catch</span> <span class="br0">(</span><span class="kw3">IllegalAccessException</span> e<span class="br0">)</span> <span class="br0">{</span><span class="kw1">throw</span> <span class="kw1">new</span> <span class="kw3">RuntimeException</span><span class="br0">(</span>e<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
&nbsp;
<span class="kw1">public</span> Pet<span class="br0">[</span><span class="br0">]</span> createArray<span class="br0">(</span><span class="kw4">int</span> size<span class="br0">)</span> <span class="br0">{</span><span class="co1">//создание массива случайных Pet </span>
    Pet<span class="br0">[</span><span class="br0">]</span> result <span class="sy0">=</span> <span class="kw1">new</span> Pet<span class="br0">[</span>size<span class="br0">]</span><span class="sy0">;</span>
    <span class="kw1">for</span> <span class="br0">(</span><span class="kw4">int</span> i<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> size<span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">)</span>
        result<span class="br0">[</span>i<span class="br0">]</span> <span class="sy0">=</span> randomPet<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">return</span> result<span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">public</span> ArrayList<span class="sy0">&lt;</span>Pet<span class="sy0">&gt;</span> arrayList<span class="br0">(</span><span class="kw4">int</span> size<span class="br0">)</span> <span class="br0">{</span><span class="co1">// создание списка случайных Pet</span>
    ArrayList<span class="sy0">&lt;</span>Pet<span class="sy0">&gt;</span> result <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>Pet<span class="sy0">&gt;</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">Collections</span>.<span class="me1">addAll</span><span class="br0">(</span>result, createArray<span class="br0">(</span>size<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">return</span> result<span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>Абстрактный метод <i><b>getTypes()</b></i> поручает производному классу получение списка объектов <i><b>Class</b></i>. В качестве типа класса указан «любой производный от <i><b>Pet</b></i>», поэтому <i><b>newInstance()</b></i> создает <i><b>Pet</b></i> без необходимости преобразования типа. Метод <i><b>randomPet()</b></i> осуществляет случайную выборку из <i><b>List</b></i> и использует полученные объекты <i><b>Class</b></i> для создания нового экземпляра данного класса вызовом <i><b>Class.newInstance()</b></i>. Метод <i><b>createArray()</b></i> использует <i><b>randomPet()</b></i> для заполнения массива, a <i><b>arrayList()</b></i>, в свою очередь, использует <i><b>createArray()</b></i>.
При вызове <i><b>newInstance()</b></i> возможны два вида исключений, обрабатываемые в секциях <i><b>catch</b></i> за блоком <i><b>try</b></i>. Имена исключений достаточно хорошо объясняют суть проблемы (<i><b>IllegalAccessException</b></i> — нарушение механизма безопасности <i>Java</i>, в данном случае если конструктор по умолчанию объявлен <i><b>private</b></i>).
Определяя субкласс <i><b>PetCreator</b></i>, достаточно предоставить список типов <i><b>Pet</b></i>, которые должны создаваться с использованием <i><b>randomPet()</b></i> и других методов. Метод <i><b>getTypes()</b></i> возвращает ссылку на статический объект <i><b>List</b></i>. Реализация с использованием <i><b>forName()</b></i> выглядит так:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/pets/ForNameCreator.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> ForNameCreator <span class="kw1">extends</span> PetCreator <span class="br0">{</span>
&nbsp;
<span class="kw1">private</span> <span class="kw1">static</span> List<span class="sy0">&lt;</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Pet<span class="sy0">&gt;&gt;</span> types <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Pet<span class="sy0">&gt;&gt;</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">private</span> <span class="kw1">static</span> <span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> typeNames <span class="sy0">=</span> <span class="br0">{</span> 
    <span class="st0">"typeinfo.pets.Mutt"</span>,
    <span class="st0">"typeinfo.pets.Pug"</span>,
    <span class="st0">"typeinfo.pets.EgyptianMau"</span>,
    <span class="st0">"typeinfo.pets.Manx"</span>,
    <span class="st0">"typeinfo.pets.Cymric"</span>,
    <span class="st0">"typeinfo.pets.Rat"</span>,
    <span class="st0">"typeinfo.pets.Mouse"</span>,
    <span class="st0">"typeinfo.pets.Hamster"</span>
    <span class="br0">}</span><span class="sy0">;</span>
&nbsp;
@SuppressWarnings<span class="br0">(</span><span class="st0">"unchecked"</span><span class="br0">)</span>
<span class="co1">// загрузчик списка классов</span>
<span class="kw1">private</span> <span class="kw1">static</span> <span class="kw4">void</span> loader<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> 
    <span class="kw1">try</span> <span class="br0">{</span> <span class="co1">//при загрузке класс приводится к типу заданному типизациии контейнера</span>
         <span class="kw1">for</span><span class="br0">(</span><span class="kw3">String</span> name <span class="sy0">:</span> typeNames<span class="br0">)</span> 
             types.<span class="me1">add</span><span class="br0">(</span><span class="br0">(</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Pet<span class="sy0">&gt;</span><span class="br0">)</span><span class="kw1">Class</span>.<span class="me1">forName</span><span class="br0">(</span>name<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span> 
        <span class="br0">}</span>   
    <span class="kw1">catch</span><span class="br0">(</span><span class="kw3">ClassNotFoundException</span> e<span class="br0">)</span> 
                    <span class="br0">{</span><span class="kw1">throw</span> <span class="kw1">new</span> <span class="kw3">RuntimeException</span><span class="br0">(</span>e<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>
<span class="br0">}</span>
<span class="co1">// статический блок ОДНОКРТАНО загружающий список при инициализации данного класса</span>
<span class="kw1">static</span> <span class="br0">{</span> loader<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
&nbsp;
@Override
<span class="kw1">public</span> List<span class="sy0">&lt;</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Pet<span class="sy0">&gt;&gt;</span> getTypes<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span><span class="kw1">return</span> types<span class="sy0">;</span><span class="br0">}</span> 
<span class="br0">}</span></pre></div></div>
<p>Метод <i><b>loader()</b></i> создает список <i><b>List</b></i> объектов <i><b>Class</b></i> с использованием метода <i><b>Class.forName()</b></i>. При этом может произойти исключение <i><b>ClassNotFoundException</b></i>,
 что вполне понятно — ведь ему передается строка, содержимое которой 
невоз­можно проверить на стадии компиляции. При ссылке на эти классы 
необходимо указывать имя пакета, которому они принадлежат (<i><b>typeinfo</b></i>).
Для получения типизованного списка объектов <i><b>Class</b></i> требуется преобразование типа, что приводит к выдаче предупреждения на стадии компиляции. Метод <i><b>loader()</b></i> определяется отдельно и размещается в секции статической инициализации, потому что директива <i><b>@SuppressWarnings</b></i> не может располагаться прямо в секции статической инициализации.
Для подсчета объектов <i><b>Pet</b></i> нам понадобится механизм подсчета их разных видов. Для этой цели идеально подойдет карта (<i><b>Мар</b></i>), в которой ключами являются имена типов <i><b>Pet</b></i>, а значениями — переменные <i><b>Integer</b></i> с количеством <i><b>Pet</b></i>. Например, это позволит получать ответы на вопросы типа «сколько существует объектов <i><b>Hamster</b></i>?». При подсчете <i><b>Pet</b></i> будет использоваться ключевое слово <i><b>instanceof</b></i>:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//typeinfo/PetCount.java</span>
<span class="co1">// Использование instanceof</span>
<span class="kw1">package</span> <span class="co2">typeinfo</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">import</span> <span class="co2">typeinfo.pets.*</span><span class="sy0">;</span> 
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">static</span> net.<span class="me1">mindview</span>.<span class="me1">util</span>.<span class="me1">Print</span>.<span class="sy0">*;</span>
<span class="kw1">public</span> <span class="kw1">class</span> PetCount <span class="br0">{</span>
&nbsp;
<span class="kw1">static</span> <span class="kw1">class</span> PetCounter <span class="kw1">extends</span> HashMap<span class="sy0">&lt;</span><span class="kw3">String</span>,Integer<span class="sy0">&gt;</span> <span class="br0">{</span> 
    <span class="kw1">public</span> <span class="kw4">void</span> count<span class="br0">(</span><span class="kw3">String</span> type<span class="br0">)</span> <span class="br0">{</span>
        <span class="kw3">Integer</span> quantity <span class="sy0">=</span> get<span class="br0">(</span>type<span class="br0">)</span><span class="sy0">;</span> 
        <span class="kw1">if</span><span class="br0">(</span>quantity <span class="sy0">==</span> <span class="kw2">null</span><span class="br0">)</span> 
            put<span class="br0">(</span>type, <span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="kw1">else</span>
            put<span class="br0">(</span>type, quantity <span class="sy0">+</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> countPets<span class="br0">(</span>PetCreator creator<span class="br0">)</span> <span class="br0">{</span>
    PetCounter counter<span class="sy0">=</span> <span class="kw1">new</span> PetCounter<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">for</span><span class="br0">(</span>Pet pet <span class="sy0">:</span> creator.<span class="me1">createArray</span><span class="br0">(</span><span class="nu0">20</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span> <span class="co1">// Подсчет всех объектов Pet: </span>
        printnb<span class="br0">(</span>pet.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getSimpleName</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">+</span> <span class="st0">" "</span><span class="br0">)</span><span class="sy0">;</span> 
&nbsp;
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Pet<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"Pet"</span><span class="br0">)</span><span class="sy0">;</span> 
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Dog<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"Dog"</span><span class="br0">)</span><span class="sy0">;</span> 
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Mutt<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"Mutt"</span><span class="br0">)</span><span class="sy0">;</span>
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Pug<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"Pug"</span><span class="br0">)</span><span class="sy0">;</span> 
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Cat<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"Cat"</span><span class="br0">)</span><span class="sy0">;</span> 
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Manx<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"EgyptіanMau"</span><span class="br0">)</span><span class="sy0">;</span>
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Manx<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"Manx"</span><span class="br0">)</span><span class="sy0">;</span>
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Manx<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"Cymric"</span><span class="br0">)</span><span class="sy0">;</span>
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Rodent<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"Rodent"</span><span class="br0">)</span><span class="sy0">;</span>
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Rat<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"Rat"</span><span class="br0">)</span><span class="sy0">;</span> 
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Mouse<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"Mouse"</span><span class="br0">)</span><span class="sy0">;</span> 
            <span class="kw1">if</span><span class="br0">(</span>pet <span class="kw1">instanceof</span> Hamster<span class="br0">)</span> counter.<span class="me1">count</span><span class="br0">(</span><span class="st0">"Hamster"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
    <span class="co1">// Вывод результатов подсчета.</span>
    print<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span>counter<span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
 <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span> 
        <span class="co1">//countPets(new ForNameCreator());</span>
     countPets<span class="br0">(</span><span class="kw1">new</span> LiteralPetCreator<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>Rat Manx Cymric Mutt Pug Cymric Pug Manx Cymric Rat EgyptianMau Hamster EgyptianMau Mutt
Mutt Cymric Mouse Pug Mouse Cymric
{Pug=3. Cat=9, Hamster=l, Cymric=7, Mouse=2, Mutt=3, Rodent=5, Pet=20, Manx=7,
EgyptianMau=7, Dog=6, Rat=2}
</pre>
<p>&lt;/spoiler&gt;
В <i><b>countPets</b></i> массив случайным образом заполняется объектами <i><b>Pet</b></i> с использованием <i><b>PetCreator</b></i>. Затем каждый объект <i><b>Pet</b></i> в массиве тестируется и подсчитывается при помощи <i><b>instanceof</b></i>.
У ключевого слова <i><b>instanceof</b></i> имеется одно серьезное ограничение: объект можно сравнивать только с именованным типом, но не с объектом <i><b>Class</b></i>. Возможно, вам показалось, что в предыдущем примере перебор всех выражений <i><b>instanceof</b></i> выглядит неудобно и громоздко, и вы правы. Тем не менее автоматизировать этот процесс невозможно — создать из объектов <i><b>Class</b></i> список <i><b>ArrayList</b></i>
 и сравнивать объекты по очереди с каждым его элементом не получится (к 
счастью, сущест­вует альтернативное решение, но это попозже). Впрочем, 
особенно горевать по этому поводу не стоит — если вам приходится 
записывать множество проверок <i><b>instanceof</b></i>, скорее всего, изъян кроется в архитектуре программы.
</p>
<h2><span class="mw-headline" id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BB.D0.B8.D1.82.D0.B5.D1.80.D0.B0.D0.BB.D0.BE.D0.B2_class"><b>Использование литералов class</b></span></h2>
<p>Если записать пример PetCreator.java с использованием литералов <i><b>class</b></i>, программа во многих отношениях становится более понятной:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//• typeinfo/pets/LiteralPetCreator.java </span>
<span class="co1">// Using class literals </span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
<span class="kw1">public</span> <span class="kw1">class</span> LiteralPetCreator <span class="kw1">extends</span> PetCreator <span class="br0">{</span> 
&nbsp;
 @SuppressWarnings<span class="br0">(</span><span class="st0">"unchecked"</span><span class="br0">)</span>
<span class="co1">// список ВСЕХ возможных типов животных непосредственно инициализированный литералами классов</span>
<span class="co1">//сделан неизменяемым  ни по размеру ни по значениям </span>
<span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">final</span> List<span class="sy0">&lt;</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Pet<span class="sy0">&gt;&gt;</span> allTypes <span class="sy0">=</span> 
          <span class="kw3">Collections</span>.<span class="me1">unmodifiableList</span><span class="br0">(</span><span class="co1">//метод создает "read-only" коллекцию</span>
             <span class="kw3">Arrays</span>.<span class="me1">asList</span><span class="br0">(</span>
                Pet.<span class="kw1">class</span>, Dog.<span class="kw1">class</span>, Cat.<span class="kw1">class</span>, Rodent.<span class="kw1">class</span>, Mutt.<span class="kw1">class</span>,
                Pug.<span class="kw1">class</span>, EgyptianMau.<span class="kw1">class</span>, Manx.<span class="kw1">class</span>, Cymric.<span class="kw1">class</span>,
                Rat.<span class="kw1">class</span>, Mouse.<span class="kw1">class</span>, Hamster.<span class="kw1">class</span>
         <span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// Типы для случайного создания: </span>
 <span class="co1">// а это уже "рабочий список" типов животных ))</span>
    <span class="kw1">private</span> <span class="kw1">static</span> <span class="kw1">final</span> List<span class="sy0">&lt;</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Pet<span class="sy0">&gt;&gt;</span> types <span class="sy0">=</span> 
            allTypes.<span class="me1">subList</span><span class="br0">(</span>allTypes.<span class="me1">indexOf</span><span class="br0">(</span>Mutt.<span class="kw1">class</span><span class="br0">)</span>,allTypes.<span class="me1">size</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    @Override
    <span class="kw1">public</span> List<span class="sy0">&lt;</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Pet<span class="sy0">&gt;&gt;</span> getTypes<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="kw1">return</span> types<span class="sy0">;</span><span class="br0">}</span>
&nbsp;
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span> 
            <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>types<span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>[class typeinfo pets.Mutt, class typeinfo.pets.Pug, class typeinfo.pets.EgyptianMau. class
typeinfo pets Manx, class typeinfo.pets.Cymric, class typeinfo.pets.Rat, class  
typeinfo.pets.Mouse, class typeinfo.pets.Hamster] 
</pre>
<p>&lt;/spoiler&gt;
В будущем примере <i><b>PetCount3.java</b></i> контейнер <i><b>Map</b></i> заполняется всеми типами <i><b>Pet</b></i> (не только генерируемыми случайным образом), поэтому нам понадобился список <i><b>allTypes</b></i>. Список <i><b>types</b></i> представляет собой часть <i><b>allTypes</b></i> (создается вызо­вом <i><b>List.subList()</b></i>) со всеми типами <i><b>Pet</b></i>, поэтому он используется для случайного генерирования <i><b>Pet</b></i>.
На этот раз при создании <i><b>types</b></i> блок <i><b>try</b></i> не 
нужен, так как необходимые проверки типов проводятся еще во время 
компиляции и исключения не возбуждаются, в отличие от метода <i><b>Class.forName()</b></i>.
Теперь библиотека <i><b>typeinfo.pets</b></i> содержит две реализации <i><b>PetCreator</b></i>. Чтобы вторая реализация использовалась по умолчанию, мы можем создать фасад (<i>façade</i>), использующий <i><b>LiteralPetCreator</b></i>:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//• typeinfo/pets/Pets.java</span>
<span class="co1">// Фасад для получения PetCreator по умолчанию</span>
<span class="kw1">package</span> <span class="co2">typeinfo.pets</span><span class="sy0">;</span>
 <span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> Pets <span class="br0">{</span>
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">final</span> PetCreator creator <span class="sy0">=</span> <span class="kw1">new</span> LiteralPetCreator<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">public</span> <span class="kw1">static</span> Pet randomPet<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="kw1">return</span> creator.<span class="me1">randomPet</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span><span class="sy0">;</span>
&nbsp;
    <span class="kw1">public</span> <span class="kw1">static</span> Pet<span class="br0">[</span><span class="br0">]</span> createArray<span class="br0">(</span><span class="kw4">int</span> size<span class="br0">)</span>
                        <span class="br0">{</span><span class="kw1">return</span> creator.<span class="me1">createArray</span><span class="br0">(</span>size<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>
    <span class="kw1">public</span> <span class="kw1">static</span> ArrayList<span class="sy0">&lt;</span>Pet<span class="sy0">&gt;</span> arrayList<span class="br0">(</span><span class="kw4">int</span> size<span class="br0">)</span> 
                        <span class="br0">{</span><span class="kw1">return</span> creator.<span class="me1">arrayList</span><span class="br0">(</span>size<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>При этом также обеспечиваются косвенные вызовы <i><b>randomPet(), createArray() и arrayList()</b></i>.
Поскольку <i><b>PetCount.countPets()</b></i> получает аргумент P<i><b>etCreator</b></i>, мы можем легко проверить работу <i><b>LiteralPetCreator</b></i> (через представленный фасад):
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">// typeinfo/PetCount2.java </span>
<span class="kw1">package</span> <span class="co2">typeinfo</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">typeinfo.pets.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> PetCount2 <span class="br0">{</span>
&nbsp;
 <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span> 
    PetCount.<span class="me1">countPets</span><span class="br0">(</span>Pets.<span class="me1">creator</span><span class="br0">)</span><span class="sy0">;</span>
 <span class="br0">}</span>
<span class="br0">}</span>
<span class="coMULTI">/* (Выполните, чтобы увидеть результат) */</span>
<span class="co1">//:- Результат будет таким же, как у PetCount.java.</span></pre></div></div>
<h2><span class="mw-headline" id=".D0.94.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D0.B2.D1.8B.D0.B7.D0.BE.D0.B2_instanceof"><b>Динамический вызов instanceof</b></span></h2>
<p>Метод <i><b>Class.isInstance()</b></i> позволяет выполнить динамическую проверку типа объекта. Благодаря ему в примере <i><b>PetCount.java</b></i> наконец-то можно будет избавиться от нагромождения <i><b>instanceof</b></i>:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">// typeinfо/PetCount3.java</span>
<span class="co1">// Using isInstance()</span>
<span class="kw1">package</span> <span class="co2">typeinfo</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">import</span> <span class="co2">typeinfo.pets.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">net.mindview.util.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">static</span> net.<span class="me1">mindview</span>.<span class="me1">util</span>.<span class="me1">Print</span>.<span class="sy0">*;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> PetCount3 <span class="br0">{</span>
&nbsp;
<span class="kw1">static</span> <span class="kw1">class</span> PetCounter <span class="kw1">extends</span> LinkedHashMap<span class="sy0">&lt;</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Pet<span class="sy0">&gt;</span>,Integer<span class="sy0">&gt;</span> <span class="br0">{</span>
    <span class="kw1">public</span> PetCounter<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
      <span class="kw1">super</span><span class="br0">(</span>MapData.<span class="me1">map</span><span class="br0">(</span>LiteralPetCreator.<span class="me1">allTypes</span>, <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
&nbsp;
    <span class="kw1">public</span> <span class="kw4">void</span> count<span class="br0">(</span>Pet pet<span class="br0">)</span> <span class="br0">{</span>
    <span class="co1">// Class.isInstance() избавляет от множественных instanceof: </span>
         <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Map</span>.<span class="me1">Entry</span><span class="sy0">&lt;</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Pet<span class="sy0">&gt;</span>,Integer<span class="sy0">&gt;</span> pair<span class="sy0">:</span> entrySet<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>
             <span class="kw1">if</span><span class="br0">(</span>pair.<span class="me1">getKey</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">isInstance</span><span class="br0">(</span>pet<span class="br0">)</span><span class="br0">)</span>
                        put<span class="br0">(</span>pair.<span class="me1">getKey</span><span class="br0">(</span><span class="br0">)</span>, pair.<span class="me1">getValue</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">+</span> <span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
&nbsp;
    @Override
    <span class="kw1">public</span> <span class="kw3">String</span> toString<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
&nbsp;
        StringBuilder result <span class="sy0">=</span> <span class="kw1">new</span> StringBuilder<span class="br0">(</span><span class="st0">"{"</span><span class="br0">)</span><span class="sy0">;</span> 
            <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Map</span>.<span class="me1">Entry</span><span class="sy0">&lt;</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Pet<span class="sy0">&gt;</span>,Integer<span class="sy0">&gt;</span> pair <span class="sy0">:</span> entrySet<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
                result.<span class="me1">append</span><span class="br0">(</span>pair.<span class="me1">getKey</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getSimpleName</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
                result.<span class="me1">append</span><span class="br0">(</span><span class="st0">"="</span><span class="br0">)</span><span class="sy0">;</span>
                result.<span class="me1">append</span><span class="br0">(</span>pair.<span class="me1">getValue</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
                result.<span class="me1">append</span><span class="br0">(</span><span class="st0">", "</span><span class="br0">)</span><span class="sy0">;</span>
            <span class="br0">}</span>
        result.<span class="me1">delete</span><span class="br0">(</span>result.<span class="me1">length</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">-</span><span class="nu0">2</span>, result.<span class="me1">length</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span> 
        result.<span class="me1">append</span><span class="br0">(</span><span class="st0">"J"</span><span class="br0">)</span><span class="sy0">;</span> 
        <span class="kw1">return</span> result.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
        PetCounter petCount <span class="sy0">=</span> <span class="kw1">new</span> PetCounter<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="kw1">for</span><span class="br0">(</span>Pet pet <span class="sy0">:</span> Pets.<span class="me1">createArray</span><span class="br0">(</span><span class="nu0">20</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
            printnb<span class="br0">(</span>pet.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getSimpleName</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">+</span> <span class="st0">" "</span><span class="br0">)</span><span class="sy0">;</span> petCount.<span class="me1">count</span><span class="br0">(</span>pet<span class="br0">)</span><span class="sy0">;</span>
        <span class="br0">}</span>
    print<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span>petCount<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
    <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>Rat Manx Cymric Mutt Pug Cymric Pug Manx Cymric Rat EgyptianMau Hamster EgyptianMau Mutt 
Mutt Cymric Mouse Pug Mouse Cymric
{Pet=20, Dog=6. Cat-9. Rodent=5, Mutt-3. Pug=3. EgyptianMau=2, Manx=7, Cymric=5, Rat-2.
Mouse=2, Hamster=l}
</pre>
<p>&lt;/spoiler&gt;
Для подсчета всех разновидностей <i><b>Pet</b></i> контейнер <i><b>PetCounter</b></i> заполняется типами из <i><b>LiteralPetCreator.allTypes</b></i>. При этом используется класс <i><b>net.mindview.util.MapData</b></i>, который получает <i><b>Iterable (allTypesList)</b></i> и константу (<i>0</i> в данном случае) и заполняет <i><b>Map</b></i> ключами из <i><b>allTypes</b></i> со значениями <i>0</i>. Без предварительного заполнения <i><b>Map</b></i> будут подсчитаны только случайно сгенерированные типы, но не базовые типы (такие, как <i><b>Pet</b></i> и <i><b>Cat</b></i>).
Как видите, метод <i><b>isInstance()</b></i> избавил нас от необходимости нагромождать конструкции с <i><b>instanceof</b></i>. Вдобавок теперь в программу можно легко добавить новые типы <i><b>Pet</b></i> — для этого следует просто изменить массив <i><b>LiteralPet Creator.types</b></i>; остальная часть программы не потребует правки (которая была бы неизбежна с операторами <i><b>instanceof</b></i>).
Метод <i><b>toString()</b></i> был перегружен для получения удобочитаемого вывода.
</p>
<h2><span class="mw-headline" id=".D0.A0.D0.B5.D0.BA.D1.83.D1.80.D1.81.D0.B8.D0.B2.D0.BD.D1.8B.D0.B9_.D0.BF.D0.BE.D0.B4.D1.81.D1.87.D0.B5.D1.82"><b>Рекурсивный подсчет</b></span></h2>
<p>Контейнер <i><b>Мар</b></i> в <i><b>PetCount3.PetCounter</b></i> был заполнен всеми классами <i><b>Pet</b></i>. Вместо предварительного заполнения карты мы также можем воспользоваться методом <i><b>Class.isAssignableFrom()</b></i> и создать обобщенный инструмент подсчета, не ограни­ченный подсчетом <i><b>Pet</b></i>:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: net/mindview/util/TypeCounter.java</span>
<span class="co1">// Подсчет экземпляров в семействе типов </span>
<span class="kw1">package</span> <span class="co2">net.mindview.util</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> TypeCounter <span class="kw1">extends</span> HashMap<span class="sy0">&lt;</span>Class<span class="sy0">&lt;?&gt;</span>,Integer<span class="sy0">&gt;</span><span class="br0">{</span>
  <span class="kw1">private</span> Class<span class="sy0">&lt;?&gt;</span> baseType<span class="sy0">;</span>
  <span class="kw1">public</span> TypeCounter<span class="br0">(</span>Class<span class="sy0">&lt;?&gt;</span> baseType<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">this</span>.<span class="me1">baseType</span> <span class="sy0">=</span> baseType<span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">void</span> count<span class="br0">(</span><span class="kw3">Object</span> obj<span class="br0">)</span> <span class="br0">{</span>
    Class<span class="sy0">&lt;?&gt;</span> type <span class="sy0">=</span> obj.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">if</span><span class="br0">(</span><span class="sy0">!</span>baseType.<span class="me1">isAssignableFrom</span><span class="br0">(</span>type<span class="br0">)</span><span class="br0">)</span>
      <span class="kw1">throw</span> <span class="kw1">new</span> <span class="kw3">RuntimeException</span><span class="br0">(</span>obj <span class="sy0">+</span> <span class="st0">" incorrect type: "</span>
        <span class="sy0">+</span> type <span class="sy0">+</span> <span class="st0">", should be type or subtype of "</span>
        <span class="sy0">+</span> baseType<span class="br0">)</span><span class="sy0">;</span>
    countClass<span class="br0">(</span>type<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>	
  <span class="kw1">private</span> <span class="kw4">void</span> countClass<span class="br0">(</span>Class<span class="sy0">&lt;?&gt;</span> type<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw3">Integer</span> quantity <span class="sy0">=</span> get<span class="br0">(</span>type<span class="br0">)</span><span class="sy0">;</span>
    put<span class="br0">(</span>type, quantity <span class="sy0">==</span> <span class="kw2">null</span> <span class="sy0">?</span> <span class="nu0">1</span> <span class="sy0">:</span> quantity <span class="sy0">+</span> <span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
    Class<span class="sy0">&lt;?&gt;</span> superClass <span class="sy0">=</span> type.<span class="me1">getSuperclass</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">if</span><span class="br0">(</span>superClass <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">&amp;&amp;</span>
       baseType.<span class="me1">isAssignableFrom</span><span class="br0">(</span>superClass<span class="br0">)</span><span class="br0">)</span>
      countClass<span class="br0">(</span>superClass<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw3">String</span> toString<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
    StringBuilder result <span class="sy0">=</span> <span class="kw1">new</span> StringBuilder<span class="br0">(</span><span class="st0">"{"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Map</span>.<span class="me1">Entry</span><span class="sy0">&lt;</span>Class<span class="sy0">&lt;?&gt;</span>,Integer<span class="sy0">&gt;</span> pair <span class="sy0">:</span> entrySet<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
      result.<span class="me1">append</span><span class="br0">(</span>pair.<span class="me1">getKey</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getSimpleName</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
      result.<span class="me1">append</span><span class="br0">(</span><span class="st0">"="</span><span class="br0">)</span><span class="sy0">;</span>
      result.<span class="me1">append</span><span class="br0">(</span>pair.<span class="me1">getValue</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
      result.<span class="me1">append</span><span class="br0">(</span><span class="st0">", "</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
    result.<span class="me1">delete</span><span class="br0">(</span>result.<span class="me1">length</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">-</span><span class="nu0">2</span>, result.<span class="me1">length</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    result.<span class="me1">append</span><span class="br0">(</span><span class="st0">"}"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">return</span> result.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>Метод <i><b>count()</b></i> получает <i><b>Class</b></i> для своего аргумента, а затем использует <i><b>.isAssignableFrom()</b></i> для проверки принадлежности объекта к интересующей вас иерархии. Метод <i><b>countClass()</b></i> сначала производит подсчет для точного типа класса, а затем, если <i><b>baseType</b></i> допускает присваивание из суперкласса, рекурсивно вызывает <i><b>countClass()</b></i> для суперкласса.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/PetCount4.java</span>
<span class="kw1">import</span> <span class="co2">typeinfo.pets.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">net.mindview.util.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">static</span> net.<span class="me1">mindview</span>.<span class="me1">util</span>.<span class="me1">Print</span>.<span class="sy0">*;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> PetCount4 <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
    TypeCounter counter <span class="sy0">=</span> <span class="kw1">new</span> TypeCounter<span class="br0">(</span>Pet.<span class="kw1">class</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">for</span><span class="br0">(</span>Pet pet <span class="sy0">:</span> Pets.<span class="me1">createArray</span><span class="br0">(</span><span class="nu0">20</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
      printnb<span class="br0">(</span>pet.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getSimpleName</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">+</span> <span class="st0">" "</span><span class="br0">)</span><span class="sy0">;</span>
      counter.<span class="me1">count</span><span class="br0">(</span>pet<span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
    print<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span>counter<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt; (Пример)
</p>
<pre>Rat Manx Cymric Mutt Pug Cymric Pug Manx Cymric Rat EgyptianMau Hamster EgyptianMau Mutt Mutt 
Cymric Mouse Pug Mouse Cymric
{Mouse=2, Dog=6, Manx=7, EgyptianMau=2, Rodent=5, Pug=3, Mutt=3. Cymric=5, Cat=9. Hamster=l, 
Pet=20, Rat=2}
</pre>
<p>&lt;/spoiler&gt;
Как видно из результатов, подсчитываются как базовые, так и конкретные типы.
</p>
<h2><span class="mw-headline" id=".D0.A0.D0.B5.D0.B3.D0.B8.D1.81.D1.82.D1.80.D0.B0.D1.86.D0.B8.D1.8F_.D1.84.D0.B0.D0.B1.D1.80.D0.B8.D0.BA"><b>Регистрация фабрик</b></span></h2>
<p>У построения объектов иерархии <i><b>Pet</b></i> есть один недостаток: каждый раз, когда в иерархию включается новый тип <i><b>Pet</b></i>, вы должны добавить его в <i><b>LiteralPetCreator.java</b></i>.
 В системах с регулярным добавлением новых классов это может создать 
проблемы.
Первое, что приходит в голову, — добавить в каждый класс статический 
инициализатор, который добавлял бы свой класс в некий список. К 
сожалению, статические инициализаторы вызываются только при первой 
загрузке класса, поэтому возникает «порочный круг»: класс отсутствует в 
списке генератора, поэтому генератор не может создать объект этого 
класса, соответственно, класс не загрузится и не будет помещен в список.
По сути, вы вынуждены создать список вручную (разве что вы напишете 
утилиту, которая будет анализировать исходный код, а затем создавать и 
компилировать список). Вероятно, лучшее, что можно сделать, — это 
разместить список в одном централизованном, очевидном месте. Вероятно, 
лучшим местом для него будет базовый класс иерархии.
В этом разделе мы также внесем другое изменение: создание объекта будет 
передано самому классу с использованием паттерна «метод-фабрика». 
Метод-фабрика может вызываться полиморфно и создает объект 
соответствующего типа. В следующей упрощенной версии методом-фабрикой 
является метод <i><b>create()</b></i> интерфейса <i><b>Factory</b></i>:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/factory/Factory.java</span>
<span class="kw1">package</span> typeinfo.<span class="me1">factory</span><span class="sy0">:</span>
 <span class="kw1">public</span> <span class="kw1">interface</span> Factory<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> <span class="br0">{</span> T create<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div>
<p>Обобщенный параметр <i><b>T</b></i> позволяет <i><b>create()</b></i> возвращать разные типы для разных реализаций <i><b>Factory</b></i>. Также при этом используется ковариантность возвращаемых типов.
В следующем примере базовый класс <i><b>Part</b></i> содержит список объектов-фабрик. Фабрики типов, которые должны создаваться методом <i><b>createRandom()</b></i>, «регистрируются» в базовом классе включением в список partFactories:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="kw1">package</span> <span class="co2">typeinfo</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">typeinfo.factory.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">class</span> Part <span class="br0">{</span>
&nbsp;
    @Override
<span class="kw1">public</span> <span class="kw3">String</span> toString<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="kw1">return</span> getClass<span class="br0">(</span><span class="br0">)</span>.<span class="me1">getSimpleName</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
&nbsp;
<span class="kw1">static</span> List<span class="sy0">&lt;</span>Factory<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Part<span class="sy0">&gt;&gt;</span>partFactories 
                        <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>Factory<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Part<span class="sy0">&gt;&gt;</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">static</span> <span class="br0">{</span>
<span class="co1">// При вызове Collections addAll() выдается предупреждение</span>
<span class="co1">// "unchecked generic array creation for varargs parameter"</span>
    partFactories.<span class="me1">add</span><span class="br0">(</span><span class="kw1">new</span> FuelFilter.<span class="me1">Factory</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    partFactories.<span class="me1">add</span><span class="br0">(</span><span class="kw1">new</span> AirFilter.<span class="me1">Factory</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    partFactories.<span class="me1">add</span><span class="br0">(</span><span class="kw1">new</span> CabinAirFilter.<span class="me1">Factory</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span> 
    partFactories.<span class="me1">add</span><span class="br0">(</span><span class="kw1">new</span> OilFilter.<span class="me1">Factory</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span> 
    partFactories.<span class="me1">add</span><span class="br0">(</span><span class="kw1">new</span> FanBelt.<span class="me1">Factory</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    partFactories.<span class="me1">add</span><span class="br0">(</span><span class="kw1">new</span> PowerSteeringBelt.<span class="me1">Factory</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span> 
    partFactories.<span class="me1">add</span><span class="br0">(</span><span class="kw1">new</span> GeneratorBelt.<span class="me1">Factory</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
   <span class="kw1">private</span> <span class="kw1">static</span> <span class="kw3">Random</span> rand <span class="sy0">=</span> <span class="kw1">new</span> <span class="kw3">Random</span><span class="br0">(</span><span class="nu0">47</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="kw1">public</span> <span class="kw1">static</span> Part createRandom<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
            <span class="kw4">int</span> n <span class="sy0">=</span> rand.<span class="me1">nextInt</span><span class="br0">(</span>partFactories.<span class="me1">size</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
            <span class="kw1">return</span> partFactories.<span class="me1">get</span><span class="br0">(</span>n<span class="br0">)</span>.<span class="me1">create</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span>
<span class="kw1">class</span> Filter <span class="kw1">extends</span> Part <span class="br0">{</span><span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> FuelFilter <span class="kw1">extends</span> Filter <span class="br0">{</span>
    <span class="co1">// Создание фабрики для каждого конкретного типа</span>
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">class</span> Factory  <span class="kw1">implements</span> typeinfo.<span class="me1">factory</span>.<span class="me1">Factory</span><span class="sy0">&lt;</span>FuelFilter<span class="sy0">&gt;</span> <span class="br0">{</span>
        @Override
        <span class="kw1">public</span> FuelFilter create<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> <span class="kw1">new</span> FuelFilter <span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> AirFilter <span class="kw1">extends</span> Filter <span class="br0">{</span> 
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">class</span> Factory <span class="kw1">implements</span> typeinfo.<span class="me1">factory</span>.<span class="me1">Factory</span><span class="sy0">&lt;</span>AirFilter<span class="sy0">&gt;</span> <span class="br0">{</span>
        @Override
        <span class="kw1">public</span> AirFilter create<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> <span class="kw1">new</span> AirFilter<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> CabinAirFilter <span class="kw1">extends</span> Filter <span class="br0">{</span> 
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">class</span> Factory <span class="kw1">implements</span> typeinfo.<span class="me1">factory</span>.<span class="me1">Factory</span><span class="sy0">&lt;</span>CabinAirFilter<span class="sy0">&gt;</span> <span class="br0">{</span>
        @Override
        <span class="kw1">public</span> CabinAirFilter create<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="kw1">return</span> <span class="kw1">new</span> CabinAirFilter<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> OilFilter <span class="kw1">extends</span> Filter <span class="br0">{</span> 
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">class</span> Factory <span class="kw1">implements</span> typeinfo.<span class="me1">factory</span>.<span class="me1">Factory</span><span class="sy0">&lt;</span>OilFilter<span class="sy0">&gt;</span> <span class="br0">{</span>
        @Override
        <span class="kw1">public</span> OilFilter create<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> <span class="kw1">new</span> OilFilter<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> Belt <span class="kw1">extends</span> Part <span class="br0">{</span><span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> FanBelt <span class="kw1">extends</span> Belt <span class="br0">{</span>
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">class</span> Factory <span class="kw1">implements</span> typeinfo.<span class="me1">factory</span>.<span class="me1">Factory</span><span class="sy0">&lt;</span>FanBelt<span class="sy0">&gt;</span> <span class="br0">{</span>
        @Override
        <span class="kw1">public</span> FanBelt create<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> <span class="kw1">new</span> FanBelt<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> GeneratorBelt <span class="kw1">extends</span> Belt <span class="br0">{</span> 
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">class</span> Factory <span class="kw1">implements</span> typeinfo.<span class="me1">factory</span>.<span class="me1">Factory</span><span class="sy0">&lt;</span>GeneratorBelt<span class="sy0">&gt;</span> <span class="br0">{</span>
        @Override
        <span class="kw1">public</span> GeneratorBelt create<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="kw1">return</span> <span class="kw1">new</span> GeneratorBelt<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>
    <span class="br0">}</span>   
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> PowerSteeringBelt <span class="kw1">extends</span> Belt <span class="br0">{</span> 
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">class</span> Factory <span class="kw1">implements</span> typeinfo.<span class="me1">factory</span>.<span class="me1">Factory</span><span class="sy0">&lt;</span>PowerSteeringBelt<span class="sy0">&gt;</span> <span class="br0">{</span>
        @Override
        <span class="kw1">public</span> PowerSteeringBelt create<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="kw1">return</span> <span class="kw1">new</span> PowerSteeringBelt<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>
   <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> RegisteredFactories <span class="br0">{</span>
&nbsp;
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span> 
        <span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> <span class="nu0">10</span><span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">)</span>
            <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>Part.<span class="me1">createRandom</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt; 
</p>
<pre>GeneratorBelt CabinAirFilter GeneratorBelt AirFilter PowerSteeringBelt CabinAirFilter Fuel 
Filter PowerSteeringBelt PowerSteeringBelt Fuel Filter 
</pre>
<p>&lt;/spoiler&gt;
He все классы иерархии рассчитаны на создание экземпляров; в нашем примере классы <i><b>Filter</b></i> и <i><b>Belt</b></i>
 существуют исключительно в целях классификации. Экземпляры этих классов
 не создаются — только одного из их субклассов. Если класс должен 
создаваться посредством <i><b>createRandom()</b></i>, он содержит внутренний класс <i><b>Factory</b></i>.
Хотя для включения всех фабрик в список можно воспользоваться вызовом <i><b>Collections.addAll()</b></i>, компилятор выдает предупреждение, поэтому я вернулся к вызовам <i><b>add()</b></i>. Метод <i><b>createRandom()</b></i> случайным образом выбирает объект фабрики из <i><b>partFactories</b></i> и вызывает его метод <i><b>create()</b></i> для получения нового объекта <i><b>Part</b></i>.
</p>
<h2><span class="mw-headline" id="instanceof_.D0.B8_.D1.81.D1.80.D0.B0.D0.B2.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_Class"><b>instanceof и сравнение Class</b></span></h2>
<p>При получении информации о типе объекта важно различать действие любой формы оператора <i><b>instanceof</b></i> (будь это сам оператор <i><b>instanceof</b></i> или метод <i><b>isInstance()</b></i> - они дают одинаковые результаты) и прямого сравнения объектов <i><b>Class</b></i>. Вот пример, который показывает, в чем их различия:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/FamilyVsExactType.java</span>
<span class="co1">// The difference between instanceof and class</span>
<span class="kw1">package</span> <span class="co2">typeinfo</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">static</span> net.<span class="me1">mindview</span>.<span class="me1">util</span>.<span class="me1">Print</span>.<span class="sy0">*;</span>
&nbsp;
<span class="kw1">class</span> Base <span class="br0">{</span><span class="br0">}</span>
<span class="kw1">class</span> Derived <span class="kw1">extends</span> Base <span class="br0">{</span><span class="br0">}</span>	
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> FamilyVsExactType <span class="br0">{</span>
  <span class="kw1">static</span> <span class="kw4">void</span> test<span class="br0">(</span><span class="kw3">Object</span> x<span class="br0">)</span> <span class="br0">{</span>
    print<span class="br0">(</span><span class="st0">"Testing x of type "</span> <span class="sy0">+</span> x.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"x instanceof Base "</span> <span class="sy0">+</span> <span class="br0">(</span>x <span class="kw1">instanceof</span> Base<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"x instanceof Derived "</span><span class="sy0">+</span> <span class="br0">(</span>x <span class="kw1">instanceof</span> Derived<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"Base.isInstance(x) "</span><span class="sy0">+</span> Base.<span class="kw1">class</span>.<span class="me1">isInstance</span><span class="br0">(</span>x<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"Derived.isInstance(x) "</span> <span class="sy0">+</span>
      Derived.<span class="kw1">class</span>.<span class="me1">isInstance</span><span class="br0">(</span>x<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"x.getClass() == Base.class "</span> <span class="sy0">+</span>
      <span class="br0">(</span>x.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> Base.<span class="kw1">class</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"x.getClass() == Derived.class "</span> <span class="sy0">+</span>
      <span class="br0">(</span>x.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> Derived.<span class="kw1">class</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"x.getClass().equals(Base.class)) "</span><span class="sy0">+</span>
      <span class="br0">(</span>x.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">equals</span><span class="br0">(</span>Base.<span class="kw1">class</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    print<span class="br0">(</span><span class="st0">"x.getClass().equals(Derived.class)) "</span> <span class="sy0">+</span>
      <span class="br0">(</span>x.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">equals</span><span class="br0">(</span>Derived.<span class="kw1">class</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
    test<span class="br0">(</span><span class="kw1">new</span> Base<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    test<span class="br0">(</span><span class="kw1">new</span> Derived<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>	
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>Testing x of type class typeinfo.Base
x instanceof Base true
x instanceof Derived false
Base.isInstance(x) true
Derived.isInstance(x) false
x.getClass() == Base.class true
x.getClass() == Derived.class false
x.getClass().equals(Base.class)) true
x.getClass().equals(Derived.class)) false
Testing x of type class typeinfo.Derived
x instanceof Base true
x instanceof Derived true
Base.isInstance(x) true
Derived.isInstance(x) true
x.getClass() == Base.class false
x.getClass() == Derived.class true
x.getClass().equals(Base.class)) false
x.getClass().equals(Derived.class)) true 
</pre>
<p>&lt;/spoiler&gt;
Метод <i><b>test()</b></i> осуществляет проверку типов полученного объекта, используя для этого обе формы оператора <i><b>instanceof</b></i>. Затем он получает ссылку на объект <i><b>Class</b></i> и использует операцию сравнения ссылок <i><b>==</b></i> и метод <i><b>equals()</b></i>, чтобы прове­рить объекты <i><b>Class</b></i> на эквивалентность. Пример доказывает справедливость утверждения о том, что действие оператора <i><b>instanceof</b></i> и метода islnstance() одинаково. Совпадают и результаты работы операции сравнения <i><b>==</b></i> и метода <i><b>equals()</b></i>. Но сами тесты приводят к разным заключениям. В соответствии с концепцией типа <i><b>instanceof</b></i> дает ответ на вопрос: «Объект принадлежит этому классу или производному от него?» С другой стороны, сравнение объектов <i><b>Class</b></i> оператором <i><b>==</b></i> не затрагивает наследования — либо тип точно совпадает, либо нет.
</p>
<h2><span class="mw-headline" id=".D0.A0.D0.B5.D1.84.D0.BB.D0.B5.D0.BA.D1.81.D0.B8.D1.8F:_.D0.B4.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B0.D1.8F_.D0.B8.D0.BD.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D0.B8.D1.8F_.D0.BE_.D0.BA.D0.BB.D0.B0.D1.81.D1.81.D0.B5"><b>Рефлексия: динамическая информация о классе</b></span></h2>
<p>Если вы не знаете точный тип объекта, <i>RTTI</i> сообщит вам его. 
Однако в этом случае существуют ограничения: тип должен быть известен 
еще во время компиляции программы, иначе определить его с помощью <i>RTTI</i>
 и сделать с этой информацией что-то полезное будет невозможно. Другими 
словами, компилятор должен располагать информацией обо всех классах, к 
которым вы затем хотели бы применить динамическое определение типов (<i>RTTI</i>).
Сначала
 кажется, что это ограничение не столь существенно, но предположим, что у
 вас появилась ссылка на объект, который не находится в пространстве 
вашей программы. Более того, класс этого объекта недоступен во время ее 
компиляции. Например, вы получили последовательность байтов с диска или 
из сетевого соединения, и вам сказали, что эта последовательность 
представляет некоторый класс. Но компилятор ничего не знал об этом 
классе, когда обрабатывал вашу программу, как же его можно использовать?
В традиционных средах программирования такая задача показалась бы 
далекой от реальности. Однако границы мира программирования все больше 
расширяются и мы все чаще встречаемся с такими ситуациями. Во-первых, 
такие возможности требуются для компонентного программирования, которое 
служит основой для систем быстрой разработки приложений (<i>Rapid Application Development, RAD</i>).
 Это визуальный подход для создания программ (экран представлен в виде 
«формы»), где значки, представляющие визуальные компоненты, 
перетаскиваются на форму. Затем происходит настройка этих компонентов, 
они устанавливаются в некоторое состояние во время работы программы. 
Чтобы изменить состояние компонентов, необходимо некоторым образом 
создавать их экземпляры, просматривать их содержимое, считывать и 
записывать внутренние значения. Вдобавок компоненты с поддержкой событий
 графического интерфейса должны как-то рассказать о них, чтобы система 
быстрой разработки приложений помогла программисту реализовать поддержку
 этих событий. Механизм рефлексии предоставляет средства для получения 
информации о доступных методах и их именах. Такое компонентное 
программирование поддерживается и в <i>Java</i>, с помощью технологии <i>JavaBeans</i>.
Другая важная предпосылка поддержки динамической информации о классе — 
предоставление возможности создавать и использовать объекты на удаленных
 платформах. Этот механизм, называемый удаленным вызовом методов (<i>Remote Method Invocation, RMI</i>), позволяет программе на <i>Java</i>
 распределять свои объекты по нескольким машинам. Необходимость в 
удаленном вызове методов возникает по разным причинам: например, при 
выполнении задачи с интенсивными вычислениями можно сбалансировать 
нагрузку по доступным компьютерам. Иногда код, выполняющий определенные 
операции, размещается на одной машине, чтобы она стала общим хранилищем 
этих операций и любые изменения кода на такой машине автоматически 
распространялись на всех клиентов этого кода. (Интересный поворот — 
компьютер существует исключительно для того, чтобы упростить внесение 
изменений в программное обеспечение!) Ко всему прочему распределенное 
программирование также поддерживает удаленное специализированное 
оборудование, которое эффективно выполняет некоторые задачи — например, 
обращение матриц, — которые при решении их на локальной машине могут 
потребовать слишком много времени и ресурсов.
Класс <i><b>Class</b></i> (уже описанный в этой главе) поддерживает концепцию рефлексии (<i>reflection</i>), для которой существует дополнительная библиотека <i><b>java.lang.reflect</b></i>, состоящая из классов <i><b>Field, Method</b></i> и <i><b>Constructor</b></i> (каждый реализует интерфейс <i><b>Member</b></i>). Объекты этих классов создаются <i>JVM</i>, чтобы представлять соответствующие члены неизвестного класса. Объекты <i><b>Constructor</b></i> используются для создания новых объектов класса, методы <i><b>get()</b></i> и <i><b>set()</b></i> — для чтения и записи значений полей класса, представленных объектами <i><b>Field</b></i>, метод <i><b>invoke()</b></i> — для вызова метода, представленного объектом <i><b>Method</b></i>. Вдобавок в классе <i><b>Class</b></i> имеются удобные методы <i><b>getFields()</b></i>, <i><b>getMethods()</b></i> и <i><b>getConstructors()</b></i>,
 которые возвращают массивы таких объектов, как поля класса, его методы и
 конструкторы. (За подробной информацией обращайтесь к описанию класса 
Class в электронной документации <i>JDK</i>.) Таким образом, информация о
 неизвестном объекте становится доступной прямо во время выполнения 
программы, а потребность в ее получении ко времени компиляции программы 
отпадает.
Важно понимать, что в механизме рефлексии нет ничего 
сверхъестественного. Когда вы используете рефлексию для работы с 
объектом неизвестного типа, виртуальная машина <i>JVM</i> рассматривает его и видит, что он принадлежит оп­ределенному классу (это делает и обычное <i>RTTI</i>), но, перед тем как проводить с ним некоторые действия, необходимо загрузить соответствующий объект <i><b>Class</b></i>. Таким образом, файл <i><b>.class</b></i> для класса этого объекта должен быть доступен <i>JVM</i> либо в сети, либо в локальной системе. Таким образом, истинное различие между традиционным <i>RTTI</i> и рефлексией состоит в том, что при использовании <i>RTTI</i> файл <i><b>.class</b></i>
 открывается и анализируется компилятором. Другими словами, вы можете 
вызывать методы объекта «нормальным» способом. При использовании 
рефлексии файл <i><b>.class</b></i> во время компиляции недоступен; он открывается и обрабатывается системой выполнения.
</p>
<h2><span class="mw-headline" id=".D0.98.D0.B7.D0.B2.D0.BB.D0.B5.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B8.D0.BD.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D0.B8.D0.B8_.D0.BE_.D0.BC.D0.B5.D1.82.D0.BE.D0.B4.D0.B0.D1.85_.D0.BA.D0.BB.D0.B0.D1.81.D1.81.D0.B0"><b>Извлечение информации о методах класса</b></span></h2>
<p>Рефлексия редко используется напрямую; она существует в языке в 
основном для поддержки других возможностей, таких как сериализация 
объектов и компоненты <i>JavaBeans</i>. Однако существуют ситуации, в 
которых динамическая информация о классе просто незаменима.
Для примера возьмем программу, выводящую на экран список методов 
некоторого класса. При просмотре исходного кода класса или его 
документации будут видны только те методы, которые были определены или 
переопределены именно в текущем классе. Но в классе может быть еще 
множество методов, доступных из его базовых классов. Искать их и сложно,
 и долго[28]. К счастью, рефлексия позволяет написать простой 
инструмент, выводящий полную информацию о полном интерфейсе класса. Вот 
как он работает:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/ShowMethods.java</span>
<span class="co1">// Использование рефлексии для вывода полного списка методов</span>
<span class="co1">// класс, в том числе и определенных в базовом классе.</span>
<span class="co1">// {Args: ShowMethods}</span>
<span class="kw1">import</span> <span class="co2">java.lang.reflect.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">java.util.regex.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">static</span> net.<span class="me1">mindview</span>.<span class="me1">util</span>.<span class="me1">Print</span>.<span class="sy0">*;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> ShowMethods <span class="br0">{</span>
&nbsp;
<span class="kw1">private</span> <span class="kw1">static</span> <span class="kw3">String</span> usage <span class="sy0">=</span> <span class="st0">"usage:<span class="es0">\n</span>"</span> 
                            <span class="sy0">+</span> <span class="st0">"ShowMethods qualified.class.name<span class="es0">\n</span>"</span>
                            <span class="sy0">+</span> <span class="st0">"To show all methods in class or:<span class="es0">\n</span>"</span> 
                            <span class="sy0">+</span> <span class="st0">"ShowMethods qualified.class.name word<span class="es0">\n</span>"</span> 
                            <span class="sy0">+</span> <span class="st0">"To search for methods involving 'word'"</span><span class="sy0">;</span>
<span class="kw1">private</span> <span class="kw1">static</span> Pattern p <span class="sy0">=</span> Pattern.<span class="me1">compile</span><span class="br0">(</span><span class="st0">"<span class="es0">\\</span>w+<span class="es0">\\</span>."</span><span class="br0">)</span><span class="sy0">;</span> 
&nbsp;
<span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span> 
    <span class="kw1">if</span><span class="br0">(</span>args.<span class="me1">length</span> <span class="sy0">&lt;</span> <span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span> 
        print<span class="br0">(</span>usage<span class="br0">)</span><span class="sy0">;</span>
        <span class="kw3">System</span>.<span class="me1">exit</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="kw4">int</span> lines <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> 
<span class="kw1">try</span> <span class="br0">{</span>
&nbsp;
    Class<span class="sy0">&lt;?&gt;</span> c <span class="sy0">=</span> <span class="kw1">Class</span>.<span class="me1">forName</span><span class="br0">(</span>args<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">)</span><span class="sy0">;</span> 
    <span class="kw3">Method</span><span class="br0">[</span><span class="br0">]</span> methods <span class="sy0">=</span> c.<span class="me1">getMethods</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> 
    <span class="kw3">Constructor</span><span class="br0">[</span><span class="br0">]</span> ctors <span class="sy0">=</span> c.<span class="me1">getConstructors</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="kw1">if</span><span class="br0">(</span>args.<span class="me1">length</span> <span class="sy0">==</span> <span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>
&nbsp;
            <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Method</span> method <span class="sy0">:</span> methods<span class="br0">)</span> 
                print<span class="br0">(</span>p.<span class="me1">matcher</span><span class="br0">(</span>method.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>.<span class="me1">replaceAll</span><span class="br0">(</span><span class="st0">""</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
            <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Constructor</span> ctor <span class="sy0">:</span> ctors<span class="br0">)</span>
                print<span class="br0">(</span>p.<span class="me1">matcher</span><span class="br0">(</span>ctor.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>.<span class="me1">replaceAll</span><span class="br0">(</span><span class="st0">""</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
            lines <span class="sy0">=</span> methods.<span class="me1">length</span> <span class="sy0">+</span> ctors.<span class="me1">length</span><span class="sy0">;</span>
&nbsp;
        <span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span>
&nbsp;
            <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Method</span> method <span class="sy0">:</span> methods<span class="br0">)</span>
                <span class="kw1">if</span> <span class="br0">(</span>method.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">indexOf</span><span class="br0">(</span>args<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">)</span> <span class="sy0">!=</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span> 
                    print<span class="br0">(</span>p.<span class="me1">matcher</span><span class="br0">(</span>method.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>.<span class="me1">replaceAll</span><span class="br0">(</span><span class="st0">""</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
                    lines<span class="sy0">++;</span>
                <span class="br0">}</span>
&nbsp;
            <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Constructor</span> ctor <span class="sy0">:</span> ctors<span class="br0">)</span>
                <span class="kw1">if</span><span class="br0">(</span>ctor.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">indexOf</span><span class="br0">(</span>args<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">)</span> <span class="sy0">!=</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span> 
                    print<span class="br0">(</span>p.<span class="me1">matcher</span><span class="br0">(</span>ctor.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>.<span class="me1">replaceAll</span><span class="br0">(</span><span class="st0">""</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
                    lines<span class="sy0">++;</span>
                <span class="br0">}</span>
        <span class="br0">}</span>
    <span class="br0">}</span><span class="kw1">catch</span><span class="br0">(</span><span class="kw3">ClassNotFoundException</span> e<span class="br0">)</span> <span class="br0">{</span>print<span class="br0">(</span><span class="st0">"No such class: "</span> <span class="sy0">+</span> e<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>
 <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>public static void main(String[]) public native int hashCodeO public final native Class getClass()
public final void wait(long.int) throws InterruptedException public final void wait() throws
InterruptedException public final native void wait(long) throws InterruptedException public 
boolean equals(Object) public String toString() public final native void notifyО public final
native void notifyAll() public ShowMethods() 
</pre>
<p>&lt;/spoiler&gt;
Методы класса <i><b>Class.getMethods()</b></i> и <i><b>getConstructors()</b></i> возвращают массивы объектов <i><b>Method</b></i> и <i><b>Constructor</b></i>,
 которые представляют методы и конструкторы класса. В каждом из этих 
классов есть методы для получения и анализа имен, аргументов и 
возвращаемых значений представляемых методов и конструкторов. Впрочем, 
также можно использовать простой метод <i><b>toString()</b></i>, как и 
сделано здесь, чтобы получить строку с полным именем метода. Остальная 
часть кода разбирает командную строку и определяет, подходит ли 
определенное выражение образцу для поиска (с использованием <i><b>indexOf()</b></i>), а после выделяет описатели имен классов.
Результат, полученный от <i><b>Class.forName()</b></i>, не может быть 
известен во время компиляции, поэтому вся информация о сигнатуре методов
 становится доступной во время выполнения. Если вы тщательно изучите 
документацию по рефлексии из <i>JDK</i>, то увидите, что рефлексия 
позволяет установить необходимые аргументы и вызвать метод объекта, 
«абсолютно неизвестного» во время компиляции программы (чуть позже будут
 приведены соответствующие примеры). Скорее всего, вам эти возможности 
никогда не понадобятся, но сам факт их существования интересен.
</p><p>Приведенный выше результат был получен из командной строки
</p>
<pre>java ShowMethods ShowMethods
</pre>
<p>На экран выводится открытый (<i><b>public</b></i>) конструктор по 
умолчанию, хотя в тексте программы такой конструктор не определяется. 
Тот конструктор, что имеется теперь в классе, автоматически сгенерирован
 компилятором. Если вы после этого сделаете класс <i><b>ShowMethods</b></i> не открытым (удалите из его определения спецификатор доступа <i><b>public</b></i>,
 то есть предоставите ему доступ в пределах пакета), сгенерированный 
компилятором конструктор исчезнет из списка методов. Сгенерированный 
конструктор имеет тот же уровень доступа, что и его класс.
</p><p>Также интересно запустить программу в виде
</p>
<pre>java ShowMethods java.lang.String
</pre>
<p>с передачей дополнительного параметра <i><b>char, int, String</b></i>
 и т. п.
Эта программа сэкономит вам немало времени при программировании, когда 
вы будете мучительно вспоминать, есть ли у этого класса определенный 
метод, если вам потребуется узнать, имеются ли у некоторого класса 
методы, воз­вращающие объекты <i><b>Color</b></i>, и т. д.
</p>
<h2><span class="mw-headline" id=".D0.94.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B5_.D0.BF.D0.BE.D1.81.D1.80.D0.B5.D0.B4.D0.BD.D0.B8.D0.BA.D0.B8"><b>Динамические посредники</b></span></h2>
<p>«Посредник» (<i>proxy</i>) принадлежит к числу основных паттернов 
проектирования. Он представляет собой объект, который подставляется на 
место «настоящего» объекта для расширения или модификации его операций. 
Приведу тривиальный пример, показывающий структуру посредника:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//. typeinfo/SimpleProxyDemo.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo</span><span class="sy0">;</span> 
<span class="kw1">import</span> <span class="co2">static.net.mindview.util.Print.*</span><span class="sy0">;</span>
<span class="kw1">interface</span> <span class="kw1">Interface</span> <span class="br0">{</span> 
        <span class="kw4">void</span> doSomething<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="kw4">void</span> somethingElse<span class="br0">(</span><span class="kw3">String</span> arg<span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> RealObject <span class="kw1">implements</span> <span class="kw1">Interface</span> <span class="br0">{</span>
    @Override
    <span class="kw1">public</span> <span class="kw4">void</span> doSomething<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>print<span class="br0">(</span><span class="st0">"doSomething"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> 
    @Override
    <span class="kw1">public</span> <span class="kw4">void</span> somethingElse<span class="br0">(</span><span class="kw3">String</span> arg<span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"somethingElse "</span> <span class="sy0">+</span> arg<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> SimpleProxy <span class="kw1">implements</span> <span class="kw1">Interface</span> <span class="br0">{</span> 
    <span class="kw1">private</span> <span class="kw1">Interface</span> proxied<span class="sy0">;</span> 
    <span class="kw1">public</span> SimpleProxy<span class="br0">(</span><span class="kw1">Interface</span> proxied<span class="br0">)</span> <span class="br0">{</span> <span class="kw1">this</span>.<span class="me1">proxied</span> <span class="sy0">=</span> proxied<span class="sy0">;</span><span class="br0">}</span>
&nbsp;
    @Override
    <span class="kw1">public</span> <span class="kw4">void</span> doSomething<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
        print<span class="br0">(</span><span class="st0">"SimpleProxy doSomething"</span><span class="br0">)</span><span class="sy0">;</span>
        proxied.<span class="me1">doSomething</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
    @Override
    <span class="kw1">public</span> <span class="kw4">void</span> somethingElse<span class="br0">(</span><span class="kw3">String</span> arg<span class="br0">)</span> <span class="br0">{</span>
        print<span class="br0">(</span><span class="st0">"SimpleProxy somethingElse "</span> <span class="sy0">+</span> arg<span class="br0">)</span><span class="sy0">;</span> 
        proxied.<span class="me1">somethingElse</span><span class="br0">(</span>arg<span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span>
<span class="kw1">class</span> SimpleProxyDemo <span class="br0">{</span>
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> consumer<span class="br0">(</span><span class="kw1">Interface</span> iface<span class="br0">)</span> <span class="br0">{</span> 
            iface.<span class="me1">doSomething</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> 
            iface.<span class="me1">somethingElse</span><span class="br0">(</span><span class="st0">"bonobo"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span> 
            consumer<span class="br0">(</span><span class="kw1">new</span> RealObject<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
            consumer<span class="br0">(</span><span class="kw1">new</span> SimpleProxy<span class="br0">(</span><span class="kw1">new</span> RealObject<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>doSomething somethingElse bonobo SimpleProxy doSomething doSomething
SimpleProxy somethingElse bonobo
somethingElse bonobo 
</pre>
<p>&lt;/spoiler&gt;
Поскольку <i><b>consumer()</b></i> получает <i><b>Interface</b></i>, он не знает, что ему передается — «настоящий» объект (<i><b>RealObject</b></i>) или посредник (<i><b>Proxy</b></i>), потому что оба типа реализуют <i><b>Interface</b></i>. Объект <i><b>Proxy</b></i>, находящийся между клиентом и «настоящим» объектом, выполняет операции, а затем вызывает идентичные методы <i><b>RealObject</b></i>.
Посредник пригодится в любой ситуации, когда требуется отделить 
дополнительные операции от «настоящего» объекта, и особенно когда нужно 
легко переключаться из режима использования дополнительных операций в 
режим отказа от них (и наоборот — главной целью паттернов является 
инкапсуляция изменений, поэтому для оправдания их применения что-то 
должно изменяться). Допустим, вы хотите отслеживать вызовы методов <i><b>RealObject</b></i>,
 измерять затраты на эти вызовы, и т. д. Такой код не должен 
встраиваться в приложение, а посредник позволит легко добавить или 
убрать его по мере необходимости.
Динамические посредники <i>Java</i> развивают концепцию посредника — и 
объект посредника создается динамически, и обработка вызовов 
опосредованных методов тоже осуществляется динамически. Все вызовы, 
обращенные к динамиче­скому посреднику, перенаправляются одному 
обработчику, который определяет, что это за вызов и как с ним следует 
поступить. Вот как выглядит пример <i><b>SimpleProxyDemo.java</b></i>, переписанный для динамического посредника:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">// typeinfo/SimpleDynamicProxy.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">java.lang.reflect.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">class</span> DynamicProxyHandler <span class="kw1">implements</span> <span class="kw3">InvocationHandler</span> <span class="br0">{</span> 
    <span class="kw1">private</span> <span class="kw3">Object</span> proxied<span class="sy0">;</span> 
    <span class="kw1">public</span> DynamicProxyHandler<span class="br0">(</span><span class="kw3">Object</span> proxied<span class="br0">)</span> <span class="br0">{</span> 
        <span class="kw1">this</span>.<span class="me1">proxied</span> <span class="sy0">=</span> proxied<span class="sy0">;</span>
    <span class="br0">}</span>
&nbsp;
    @Override
    <span class="kw1">public</span> <span class="kw3">Object</span> invoke<span class="br0">(</span><span class="kw3">Object</span> proxy, <span class="kw3">Method</span> method, <span class="kw3">Object</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> 
                                                        <span class="kw1">throws</span> <span class="kw3">Throwable</span> <span class="br0">{</span>
        <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span> <span class="br0">(</span><span class="st0">"**** proxy. "</span> <span class="sy0">+</span> proxy.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span> 
                    <span class="sy0">+</span> <span class="st0">", method- "</span> <span class="sy0">+</span> method <span class="sy0">+</span> <span class="st0">", args "</span> <span class="sy0">+</span> args<span class="br0">)</span><span class="sy0">;</span> 
        <span class="kw1">if</span><span class="br0">(</span>args <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">)</span> 
            <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Object</span> arg <span class="sy0">:</span> args<span class="br0">)</span> 
                <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">" "</span> <span class="sy0">+</span> arg<span class="br0">)</span><span class="sy0">;</span> 
&nbsp;
        <span class="kw1">return</span> method.<span class="me1">invoke</span><span class="br0">(</span>proxied, args<span class="br0">)</span><span class="sy0">;</span>
        <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> SimpleDynamicProxy <span class="br0">{</span>
&nbsp;
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> consumer<span class="br0">(</span><span class="kw1">Interface</span> іface<span class="br0">)</span> <span class="br0">{</span> 
        іface.<span class="me1">doSomething</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> 
        іface.<span class="me1">somethingElse</span><span class="br0">(</span><span class="st0">"bonobo"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
        RealObject real <span class="sy0">=</span> <span class="kw1">new</span> RealObject<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> 
        consumer<span class="br0">(</span>real<span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">// Вставляєм посредника и вызываем снова: </span>
        <span class="kw1">Interface</span> proxy <span class="sy0">=</span> <span class="br0">(</span><span class="kw1">Interface</span><span class="br0">)</span><span class="kw3">Proxy</span>.<span class="me1">newProxyInstance</span><span class="br0">(</span> 
                           <span class="kw1">Interface</span>.<span class="kw1">class</span>.<span class="me1">getClassLoader</span><span class="br0">(</span><span class="br0">)</span>, 
                           <span class="kw1">new</span> <span class="kw1">Class</span><span class="br0">[</span><span class="br0">]</span><span class="br0">{</span><span class="kw1">Interface</span>.<span class="kw1">class</span><span class="br0">}</span>, 
                           <span class="kw1">new</span> DynamicProxyHandler<span class="br0">(</span>real<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span> 
        consumer<span class="br0">(</span>proxy<span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>**** proxy: class SProxy(). method: public abstract void Interface.doSomething(), args: null
doSomething
**** proxy: class SProxy(). method: public abstract void
Interface.somethingElse(java.1ang.String), 
args: [Ljava.1ang.Object.@42e816
bonobo
somethingElse bonobo
</pre>
<p>&lt;/spoiler&gt;
Динамический посредник создается вызовом статического метода <i><b>Proxy.newProxyInstance()</b></i>,
 которому должен передаваться загрузчик класса, список интерфейсов, 
которые должны реализовываться посредником (а не классов или абстрактных
 классов!), а также реализация интерфейса <i><b>InvocationHandler</b></i>.
 Динамический посредник перенаправляет все вызовы обработчику, поэтому 
конструктор обработчика обычно получает ссылку на «настоящий» объект для
 пере­направления ему запросов.
Метод <i><b>invoke()</b></i> получает объект посредника на случай, если 
ему понадобится определить, откуда поступил запрос — впрочем, обычно это
 несущественно. Будьте внимательны при вызове методов посредника из <i><b>invoke()</b></i>, потому что вызовы через интерфейс перенаправляются через посредника.
В общем случае вы выполняете опосредованную операцию, а затем используете <i><b>Method.invoke()</b></i>
 для перенаправления запроса опосредованному объекту с передачей 
необходимых аргументов. При этом некоторые вызовы методов могут 
отфильтровываться, а другие — проходить:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/SelectingMethods.java</span>
<span class="co1">// Looking for particular methods in a dynamic proxy.</span>
<span class="kw1">import</span> <span class="co2">java.lang.reflect.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">static</span> net.<span class="me1">mindview</span>.<span class="me1">util</span>.<span class="me1">Print</span>.<span class="sy0">*;</span>
&nbsp;
<span class="kw1">class</span> MethodSelector <span class="kw1">implements</span> <span class="kw3">InvocationHandler</span> <span class="br0">{</span>
  <span class="kw1">private</span> <span class="kw3">Object</span> proxied<span class="sy0">;</span>
  <span class="kw1">public</span> MethodSelector<span class="br0">(</span><span class="kw3">Object</span> proxied<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">this</span>.<span class="me1">proxied</span> <span class="sy0">=</span> proxied<span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw3">Object</span>
  invoke<span class="br0">(</span><span class="kw3">Object</span> proxy, <span class="kw3">Method</span> method, <span class="kw3">Object</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span>
  <span class="kw1">throws</span> <span class="kw3">Throwable</span> <span class="br0">{</span>
    <span class="kw1">if</span><span class="br0">(</span>method.<span class="me1">getName</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">equals</span><span class="br0">(</span><span class="st0">"interesting"</span><span class="br0">)</span><span class="br0">)</span>
      print<span class="br0">(</span><span class="st0">"Proxy detected the interesting method"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">return</span> method.<span class="me1">invoke</span><span class="br0">(</span>proxied, args<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span>	
&nbsp;
<span class="kw1">interface</span> SomeMethods <span class="br0">{</span>
  <span class="kw4">void</span> boring1<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">void</span> boring2<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">void</span> interesting<span class="br0">(</span><span class="kw3">String</span> arg<span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">void</span> boring3<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">class</span> Implementation <span class="kw1">implements</span> SomeMethods <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw4">void</span> boring1<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"boring1"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">void</span> boring2<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"boring2"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">void</span> interesting<span class="br0">(</span><span class="kw3">String</span> arg<span class="br0">)</span> <span class="br0">{</span>
    print<span class="br0">(</span><span class="st0">"interesting "</span> <span class="sy0">+</span> arg<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">void</span> boring3<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"boring3"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
<span class="br0">}</span>	
&nbsp;
<span class="kw1">class</span> SelectingMethods <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
    SomeMethods proxy<span class="sy0">=</span> <span class="br0">(</span>SomeMethods<span class="br0">)</span><span class="kw3">Proxy</span>.<span class="me1">newProxyInstance</span><span class="br0">(</span>
      SomeMethods.<span class="kw1">class</span>.<span class="me1">getClassLoader</span><span class="br0">(</span><span class="br0">)</span>,
      <span class="kw1">new</span> <span class="kw1">Class</span><span class="br0">[</span><span class="br0">]</span><span class="br0">{</span> SomeMethods.<span class="kw1">class</span> <span class="br0">}</span>,
      <span class="kw1">new</span> MethodSelector<span class="br0">(</span><span class="kw1">new</span> Implementation<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    proxy.<span class="me1">boring1</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    proxy.<span class="me1">boring2</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    proxy.<span class="me1">interesting</span><span class="br0">(</span><span class="st0">"bonobo"</span><span class="br0">)</span><span class="sy0">;</span>
    proxy.<span class="me1">boring3</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>boring1
boring2
Proxy detected the interesting method
interesting bonobo
boring3
</pre>
<p>&lt;/spoiler&gt;
В данном случае мы просто проверяем имена методов, но с таким же успехом
 можно анализировать другие аспекты сигнатуры и даже значения 
аргументов.
Вряд ли вам придется каждый день пользоваться динамическими 
посредниками, но они хорошо подходят для решения многих разновидностей 
задач.
</p>
<h2><span class="mw-headline" id=".D0.9E.D0.B1.D1.8A.D0.B5.D0.BA.D1.82.D1.8B_.D1.81_.D0.BD.D0.B5.D0.BE.D0.BF.D1.80.D0.B5.D0.B4.D0.B5.D0.BB.D0.B5.D0.BD.D0.BD.D1.8B.D0.BC_.D1.81.D0.BE.D1.81.D1.82.D0.BE.D1.8F.D0.BD.D0.B8.D0.B5.D0.BC"><b>Объекты с неопределенным состоянием</b></span></h2>
<p>Если использовать для обозначения неопределенного состояния (то есть отсутствия) объекта встроенное значение <i><b>null</b></i>, то при каждом использовании ссылки придется проверять, не равна ли она <i><b>null</b></i>. Это быстро утомляет, а код получается излишне громоздким. Проблема заключается в том, что <i><b>null</b></i> не имеет собственного поведения, кроме выдачи <i><b>NullPointerException</b></i>
 при попытке выполнения с ним какой-либо операции. Иногда бывает полезно
 ввести понятие объекта с неопределенным состоянием, который принимает 
сообщения, но возвращает значение, свидетельствующее об отсутствии 
«настоящего» объекта. Таким образом, вы можете считать, что все объекты 
действительны, и вам не придется тратить время на проверки <i><b>null</b></i>
 (и читать полученный код).
Было бы интересно представить себе язык программирования, автоматически 
создающий объекты с неопределенным состоянием, но на практике они 
применяются не так уж часто — иногда проверки <i><b>null</b></i> оказывается достаточно, иногда можно уверенно считать, что значение <i><b>null</b></i> вам не попадется, а иногда даже обработка аномальных ситуаций через <i><b>NullPointerException</b></i>
 является допустимой. Наибольшую пользу объекты с неопределенным 
состоянием приносят «вблизи от данных», представляя сущности в 
пространстве задачи. Простой пример: во многих системах имеется класс <i><b>Person</b></i>,
 а в коде возникают ситуации, когда объект не представляет конкретную 
личность (или, по крайней мере, информация о ней недоступна); при 
традиционном подходе вам следовало бы проверить ссылку <i><b>null</b></i>.
 Также можно воспользоваться объектом с неопределенным состоянием, но, 
даже несмотря на то, что такой объект будет отвечать на все сообщения, 
на которые отвечает «настоящий» объект, все равно потребуется способ 
проверки его на «определенность». Проще всего определить для этого 
специальный интерфейс:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//. net/mindview/uti1/Null.java </span>
<span class="kw1">package</span> <span class="co2">net.mindview.util</span><span class="sy0">;</span> 
      <span class="kw1">public</span> <span class="kw1">interface</span> <span class="kw2">Null</span> <span class="br0">{</span><span class="br0">}</span></pre></div></div>
<p>Это позволяет <i><b>instanceof</b></i> обнаруживать объекты с неопределенным состоянием и, что еще важнее, не требует включения метода <i><b>isNull()</b></i> во все классы (в конце концов, это фактически будет другим способом выполнения <i>RTTI</i> — так почему бы сразу не воспользоваться встроенными средствами?):
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">// typeinfo/Person.java</span>
<span class="co1">// Класс с неопределенным состоянием объекта</span>
<span class="kw1">package</span> <span class="co2">typeinfo</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">net.mindview.util.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">class</span> Person <span class="br0">{</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">final</span> <span class="kw3">String</span> first<span class="sy0">;</span> 
<span class="kw1">public</span> <span class="kw1">final</span> <span class="kw3">String</span> last<span class="sy0">;</span> 
<span class="kw1">public</span> <span class="kw1">final</span> <span class="kw3">String</span> address<span class="sy0">;</span> <span class="co1">// И t д.</span>
<span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">final</span> Person <span class="kw2">NULL</span> <span class="sy0">=</span> <span class="kw1">new</span> NullPerson<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
    <span class="kw1">public</span> Person<span class="br0">(</span><span class="kw3">String</span> first, <span class="kw3">String</span> last, <span class="kw3">String</span> address<span class="br0">)</span><span class="br0">{</span> 
        <span class="kw1">this</span>.<span class="me1">first</span> <span class="sy0">=</span> first<span class="sy0">;</span>
        <span class="kw1">this</span>.<span class="me1">last</span> <span class="sy0">=</span> last<span class="sy0">;</span> 
        <span class="kw1">this</span>.<span class="me1">address</span> <span class="sy0">=</span> address<span class="sy0">;</span>
    <span class="br0">}</span>
&nbsp;
    @Override
    <span class="kw1">public</span> <span class="kw3">String</span> toString<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
        <span class="kw1">return</span> <span class="st0">"Person: "</span> <span class="sy0">+</span> first <span class="sy0">+</span> <span class="st0">" "</span> <span class="sy0">+</span> last <span class="sy0">+</span> <span class="st0">" "</span> <span class="sy0">+</span> address<span class="sy0">;</span>
    <span class="br0">}</span>
&nbsp;
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">class</span> NullPerson <span class="kw1">extends</span> Person <span class="kw1">implements</span> <span class="kw2">Null</span> <span class="br0">{</span>
        <span class="kw1">private</span> NullPerson<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> 
            <span class="kw1">super</span><span class="br0">(</span><span class="st0">"None"</span>, <span class="st0">"None"</span>, <span class="st0">"None"</span><span class="br0">)</span><span class="sy0">;</span> 
        <span class="br0">}</span> 
        @Override
        <span class="kw1">public</span> <span class="kw3">String</span> toString<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> <span class="st0">"NullPerson"</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>В общем случае объект с неопределенным состоянием является синглетным, поэтому он создается как экземпляр <i><b>static final</b></i>. Это возможно благодаря тому, что объект <i><b>Person</b></i>
 неизменяем — значения задаются в конструкторе, а затем чи­таются, но не
 могут изменяться (поскольку поля String по своей природе неизменяемы). 
Если вы захотите изменить <i><b>NullPerson</b></i>, его придется заменить новым объектом <i><b>Person</b></i>. Обратите внимание: для обнаружения обобщенной поддержки <i><b>Null</b></i> или более конкретного типа <i><b>NullPerson</b></i> можно использовать <i><b>instanceof</b></i>, но при синглетной архитектуре можно воспользоваться просто <i><b>equals()</b></i> или даже <i><b>==</b></i> для сравнения с <i><b>Person.NULL</b></i>.
Представьте, что вы собираетесь открыть новое предприятие, но, пока вакансии еще не заполнены, в каждой должности <i><b>Position</b></i> можно временно хранить «заполнитель» — объект <i><b>Person</b></i> с неопределенным состоянием:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//• typeinfo/Position.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">class</span> <span class="kw3">Position</span> <span class="br0">{</span>
    <span class="kw1">private</span> <span class="kw3">String</span> title<span class="sy0">;</span> 
    <span class="kw1">private</span> Person person<span class="sy0">;</span>
        <span class="kw1">public</span> <span class="kw3">Position</span><span class="br0">(</span><span class="kw3">String</span> jobTitle, Person employee<span class="br0">)</span> <span class="br0">{</span> 
            title <span class="sy0">=</span> jobTitle<span class="sy0">;</span> 
            person <span class="sy0">=</span> employee<span class="sy0">;</span> 
                <span class="kw1">if</span><span class="br0">(</span>person <span class="sy0">==</span> <span class="kw2">null</span><span class="br0">)</span>
                    person <span class="sy0">=</span> Person.<span class="kw2">NULL</span><span class="sy0">;</span>
        <span class="br0">}</span>
        <span class="kw1">public</span> <span class="kw3">Position</span><span class="br0">(</span><span class="kw3">String</span> jobTitle<span class="br0">)</span> <span class="br0">{</span> 
            title <span class="sy0">=</span> jobTitle<span class="sy0">;</span> 
            person <span class="sy0">=</span> Person.<span class="kw2">NULL</span><span class="sy0">;</span>
&nbsp;
        <span class="br0">}</span>
        <span class="kw1">public</span> <span class="kw3">String</span> getTitle<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> title<span class="sy0">;</span> <span class="br0">}</span> 
        <span class="kw1">public</span> <span class="kw4">void</span> setTitle<span class="br0">(</span><span class="kw3">String</span> newTitle<span class="br0">)</span> <span class="br0">{</span> title <span class="sy0">=</span> newTitle<span class="sy0">;</span><span class="br0">}</span>
        <span class="kw1">public</span> Person getPerson<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> person<span class="sy0">;</span> <span class="br0">}</span> 
        <span class="kw1">public</span> <span class="kw4">void</span> setPerson<span class="br0">(</span>Person newPerson<span class="br0">)</span> <span class="br0">{</span> 
            person <span class="sy0">=</span> newPerson<span class="sy0">;</span> 
            <span class="kw1">if</span><span class="br0">(</span>person <span class="sy0">==</span> <span class="kw2">null</span><span class="br0">)</span>
                person <span class="sy0">=</span> Person.<span class="kw2">NULL</span><span class="sy0">;</span>
        <span class="br0">}</span>
    @Override
        <span class="kw1">public</span> <span class="kw3">String</span> toString<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
            <span class="kw1">return</span> <span class="st0">"Position: "</span> <span class="sy0">+</span> title <span class="sy0">+</span> <span class="st0">" "</span> <span class="sy0">+</span> person<span class="sy0">;</span> 
        <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>Превращать <i><b>Position</b></i> в объект с неопределенным состоянием не обязательно, потому что существование <i><b>Person.NULL</b></i> подразумевает неопределенность <i><b>Position</b></i> (возможно, позднее выяснится, что явная поддержка неопределенного состояния для <i><b>Position</b></i>
 нужна, и вы добавите ее, но в соответствии с одним из канонов 
экстремального программирования в начальный проект следует включить 
«простейшее решение, которое будет работать», и включать новые функции 
лишь по мере возникновения реальной необходимости).
Теперь класс <i><b>Staff</b></i> может проверять объекты с неопределенным состоянием при заполнении вакансий:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/Staff.java</span>
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> Staff <span class="kw1">extends</span> ArrayList<span class="sy0">&lt;</span>Position<span class="sy0">&gt;</span> <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw4">void</span> add<span class="br0">(</span><span class="kw3">String</span> title, Person person<span class="br0">)</span> <span class="br0">{</span>
    add<span class="br0">(</span><span class="kw1">new</span> <span class="kw3">Position</span><span class="br0">(</span>title, person<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">void</span> add<span class="br0">(</span><span class="kw3">String</span>... <span class="me1">titles</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">for</span><span class="br0">(</span><span class="kw3">String</span> title <span class="sy0">:</span> titles<span class="br0">)</span>
      add<span class="br0">(</span><span class="kw1">new</span> <span class="kw3">Position</span><span class="br0">(</span>title<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> Staff<span class="br0">(</span><span class="kw3">String</span>... <span class="me1">titles</span><span class="br0">)</span> <span class="br0">{</span> add<span class="br0">(</span>titles<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">boolean</span> positionAvailable<span class="br0">(</span><span class="kw3">String</span> title<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Position</span> position <span class="sy0">:</span> <span class="kw1">this</span><span class="br0">)</span>
      <span class="kw1">if</span><span class="br0">(</span>position.<span class="me1">getTitle</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">equals</span><span class="br0">(</span>title<span class="br0">)</span> <span class="sy0">&amp;&amp;</span>
         position.<span class="me1">getPerson</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> Person.<span class="kw2">NULL</span><span class="br0">)</span>
        <span class="kw1">return</span> <span class="kw2">true</span><span class="sy0">;</span>
    <span class="kw1">return</span> <span class="kw2">false</span><span class="sy0">;</span>
  <span class="br0">}</span>	
  <span class="kw1">public</span> <span class="kw4">void</span> fillPosition<span class="br0">(</span><span class="kw3">String</span> title, Person hire<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Position</span> position <span class="sy0">:</span> <span class="kw1">this</span><span class="br0">)</span>
      <span class="kw1">if</span><span class="br0">(</span>position.<span class="me1">getTitle</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">equals</span><span class="br0">(</span>title<span class="br0">)</span> <span class="sy0">&amp;&amp;</span>
         position.<span class="me1">getPerson</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> Person.<span class="kw2">NULL</span><span class="br0">)</span> <span class="br0">{</span>
        position.<span class="me1">setPerson</span><span class="br0">(</span>hire<span class="br0">)</span><span class="sy0">;</span>
        <span class="kw1">return</span><span class="sy0">;</span>
      <span class="br0">}</span>
    <span class="kw1">throw</span> <span class="kw1">new</span> <span class="kw3">RuntimeException</span><span class="br0">(</span>
      <span class="st0">"Position "</span> <span class="sy0">+</span> title <span class="sy0">+</span> <span class="st0">" not available"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>	
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
    Staff staff <span class="sy0">=</span> <span class="kw1">new</span> Staff<span class="br0">(</span><span class="st0">"President"</span>, <span class="st0">"CTO"</span>,
      <span class="st0">"Marketing Manager"</span>, <span class="st0">"Product Manager"</span>,
      <span class="st0">"Project Lead"</span>, <span class="st0">"Software Engineer"</span>,
      <span class="st0">"Software Engineer"</span>, <span class="st0">"Software Engineer"</span>,
      <span class="st0">"Software Engineer"</span>, <span class="st0">"Test Engineer"</span>,
      <span class="st0">"Technical Writer"</span><span class="br0">)</span><span class="sy0">;</span>
    staff.<span class="me1">fillPosition</span><span class="br0">(</span><span class="st0">"President"</span>,
      <span class="kw1">new</span> Person<span class="br0">(</span><span class="st0">"Me"</span>, <span class="st0">"Last"</span>, <span class="st0">"The Top, Lonely At"</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    staff.<span class="me1">fillPosition</span><span class="br0">(</span><span class="st0">"Project Lead"</span>,
      <span class="kw1">new</span> Person<span class="br0">(</span><span class="st0">"Janet"</span>, <span class="st0">"Planner"</span>, <span class="st0">"The Burbs"</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">if</span><span class="br0">(</span>staff.<span class="me1">positionAvailable</span><span class="br0">(</span><span class="st0">"Software Engineer"</span><span class="br0">)</span><span class="br0">)</span>
      staff.<span class="me1">fillPosition</span><span class="br0">(</span><span class="st0">"Software Engineer"</span>,
        <span class="kw1">new</span> Person<span class="br0">(</span><span class="st0">"Bob"</span>, <span class="st0">"Coder"</span>, <span class="st0">"Bright Light City"</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>staff<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>[Position: President Person: Me Last The Top. Lonely At, Position. СТО NullPerson, Position: 
Marketing Manager NullPerson. Position: Product Manager NullPerson, Position. Project Lead 
Person: Janet Planner The Burbs. Position: Software Engineer Person: Bob Coder Bright Light City,
Position: Software Engineer NullPerson, Position: Software Engineer NullPerson. Position- 
Software Engineer NullPerson. Position. Test Engineer NullPerson. Position: Technical Writer 
NullPerson]
</pre>
<p>&lt;/spoiler&gt;
Обратите внимание: в некоторых местах нам по-прежнему приходится 
проверять объекты на определенное состояние, что принципиально не 
отличается от проверки <i><b>null</b></i>, но в других местах, скажем, при преобразованиях <i><b>toString()</b></i>, лишние проверки не нужны; мы просто считаем, что ссылка на объект действительна.
</p><p>Если вместо конкретных классов используются интерфейсы, для 
автоматического создания объектов с неопределенным состоянием можно 
воспользоваться динамическим посредником. Допустим, имеется интерфейс <i><b>Robot</b></i>, определяющий имя и модель робота, а также список <i><b>List&lt;Operation&gt;</b></i>, определяющий, какие операции выполняет робот. Операция состоит из описания и команды:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/Operation.java</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">interface</span> <span class="kw3">Operation</span> <span class="br0">{</span>
  <span class="kw3">String</span> description<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw4">void</span> command<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span></pre></div></div>
<p>Чтобы воспользоваться услугами робота, следует вызвать метод <i><b>operations()</b></i>:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/Robot.java</span>
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">net.mindview.util.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">interface</span> <span class="kw3">Robot</span> <span class="br0">{</span>
  <span class="kw3">String</span> name<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw3">String</span> model<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  List<span class="sy0">&lt;</span>Operation<span class="sy0">&gt;</span> operations<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="kw1">class</span> Test <span class="br0">{</span>
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> test<span class="br0">(</span><span class="kw3">Robot</span> r<span class="br0">)</span> <span class="br0">{</span>
      <span class="kw1">if</span><span class="br0">(</span>r <span class="kw1">instanceof</span> <span class="kw2">Null</span><span class="br0">)</span>
        <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"[Null Robot]"</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"Название: "</span> <span class="sy0">+</span> r.<span class="me1">name</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"Модель: "</span> <span class="sy0">+</span> r.<span class="me1">model</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Operation</span> operation <span class="sy0">:</span> r.<span class="me1">operations</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
        <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>operation.<span class="me1">description</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
        operation.<span class="me1">command</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="br0">}</span>
    <span class="br0">}</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>При этом используется вложенный класс, выполняющий проверку. Теперь мы можем создать робота для уборки снега:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/SnowRemovalRobot.java</span>
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> SnowRemovalRobot <span class="kw1">implements</span> <span class="kw3">Robot</span> <span class="br0">{</span>
  <span class="kw1">private</span> <span class="kw3">String</span> name<span class="sy0">;</span>
  <span class="kw1">public</span> SnowRemovalRobot<span class="br0">(</span><span class="kw3">String</span> name<span class="br0">)</span> <span class="br0">{</span><span class="kw1">this</span>.<span class="me1">name</span> <span class="sy0">=</span> name<span class="sy0">;</span><span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw3">String</span> name<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> name<span class="sy0">;</span> <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw3">String</span> model<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> <span class="st0">"SnowBot Series 11"</span><span class="sy0">;</span> <span class="br0">}</span>
  <span class="kw1">public</span> List<span class="sy0">&lt;</span>Operation<span class="sy0">&gt;</span> operations<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">return</span> <span class="kw3">Arrays</span>.<span class="me1">asList</span><span class="br0">(</span>
      <span class="kw1">new</span> <span class="kw3">Operation</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
        <span class="kw1">public</span> <span class="kw3">String</span> description<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
          <span class="kw1">return</span> name <span class="sy0">+</span> <span class="st0">" может убирать снег"</span><span class="sy0">;</span>
        <span class="br0">}</span>
        <span class="kw1">public</span> <span class="kw4">void</span> command<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
          <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>name <span class="sy0">+</span> <span class="st0">"  убирает снег"</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="br0">}</span>
      <span class="br0">}</span>,	
      <span class="kw1">new</span> <span class="kw3">Operation</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
        <span class="kw1">public</span> <span class="kw3">String</span> description<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
          <span class="kw1">return</span> name <span class="sy0">+</span> <span class="st0">"  может колоть лед"</span><span class="sy0">;</span>
        <span class="br0">}</span>
        <span class="kw1">public</span> <span class="kw4">void</span> command<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
          <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>name <span class="sy0">+</span> <span class="st0">" колет лед"</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="br0">}</span>
      <span class="br0">}</span>,
      <span class="kw1">new</span> <span class="kw3">Operation</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
        <span class="kw1">public</span> <span class="kw3">String</span> description<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
          <span class="kw1">return</span> name <span class="sy0">+</span> <span class="st0">" может чистить крышу"</span><span class="sy0">;</span>
        <span class="br0">}</span>
        <span class="kw1">public</span> <span class="kw4">void</span> command<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
          <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>name <span class="sy0">+</span> <span class="st0">" чистит крышу"</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="br0">}</span>
      <span class="br0">}</span>
    <span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>	
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw3">Robot</span>.<span class="me1">Test</span>.<span class="me1">test</span><span class="br0">(</span><span class="kw1">new</span> SnowRemovalRobot<span class="br0">(</span><span class="st0">"Slusher"</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt; 
</p>
<pre>Название: Slusher 
Модель: SnowBot Series 11 
Slusher может убирать снег 
Slusher убирает снег 
Slusher может колоть лед 
Slusher колет лед 
Slusher может чистить крышу 
Slusher чистит крышу 
</pre>
<p>&lt;/spoiler&gt;
Предполагается, что существуют разные типы роботов, и для каждого типа <i><b>Robot</b></i> объект с неопределенным состоянием должен делать что-то особенное — в нашем примере выдавать информацию о конкетном типе <i><b>Robot</b></i>, представленном объектом. Эта информация перехватывается динамическим посредником:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/NullRobot.java</span>
<span class="co1">// Использование динамического посредника для создания</span>
<span class="co1">// объекта с неопределенным состоянием </span>
<span class="kw1">import</span> <span class="co2">java.lang.reflect.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">net.mindview.util.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">class</span> NullRobotProxyHandler <span class="kw1">implements</span> <span class="kw3">InvocationHandler</span> <span class="br0">{</span>
  <span class="kw1">private</span> <span class="kw3">String</span> nullName<span class="sy0">;</span>
  <span class="kw1">private</span> <span class="kw3">Robot</span> proxied <span class="sy0">=</span> <span class="kw1">new</span> NRobot<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
  NullRobotProxyHandler<span class="br0">(</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Robot<span class="sy0">&gt;</span> type<span class="br0">)</span> <span class="br0">{</span>
    nullName <span class="sy0">=</span> type.<span class="me1">getSimpleName</span><span class="br0">(</span><span class="br0">)</span> <span class="sy0">+</span> <span class="st0">" NullRobot"</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">private</span> <span class="kw1">class</span> NRobot <span class="kw1">implements</span> <span class="kw2">Null</span>, <span class="kw3">Robot</span> <span class="br0">{</span>
    <span class="kw1">public</span> <span class="kw3">String</span> name<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> nullName<span class="sy0">;</span> <span class="br0">}</span>
    <span class="kw1">public</span> <span class="kw3">String</span> model<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> nullName<span class="sy0">;</span> <span class="br0">}</span>
    <span class="kw1">public</span> List<span class="sy0">&lt;</span>Operation<span class="sy0">&gt;</span> operations<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
      <span class="kw1">return</span> <span class="kw3">Collections</span>.<span class="me1">emptyList</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
  <span class="br0">}</span>	
  <span class="kw1">public</span> <span class="kw3">Object</span>
  invoke<span class="br0">(</span><span class="kw3">Object</span> proxy, <span class="kw3">Method</span> method, <span class="kw3">Object</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span>
  <span class="kw1">throws</span> <span class="kw3">Throwable</span> <span class="br0">{</span>
    <span class="kw1">return</span> method.<span class="me1">invoke</span><span class="br0">(</span>proxied, args<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> NullRobot <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw3">Robot</span>
  newNullRobot<span class="br0">(</span>Class<span class="sy0">&lt;?</span> <span class="kw1">extends</span> Robot<span class="sy0">&gt;</span> type<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">return</span> <span class="br0">(</span><span class="kw3">Robot</span><span class="br0">)</span><span class="kw3">Proxy</span>.<span class="me1">newProxyInstance</span><span class="br0">(</span>
      NullRobot.<span class="kw1">class</span>.<span class="me1">getClassLoader</span><span class="br0">(</span><span class="br0">)</span>,
      <span class="kw1">new</span> <span class="kw1">Class</span><span class="br0">[</span><span class="br0">]</span><span class="br0">{</span> <span class="kw2">Null</span>.<span class="kw1">class</span>, <span class="kw3">Robot</span>.<span class="kw1">class</span> <span class="br0">}</span>,
      <span class="kw1">new</span> NullRobotProxyHandler<span class="br0">(</span>type<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>	
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw3">Robot</span><span class="br0">[</span><span class="br0">]</span> bots <span class="sy0">=</span> <span class="br0">{</span>
      <span class="kw1">new</span> SnowRemovalRobot<span class="br0">(</span><span class="st0">"SnowBee"</span><span class="br0">)</span>,
      newNullRobot<span class="br0">(</span>SnowRemovalRobot.<span class="kw1">class</span><span class="br0">)</span>
    <span class="br0">}</span><span class="sy0">;</span>
    <span class="kw1">for</span><span class="br0">(</span><span class="kw3">Robot</span> bot <span class="sy0">:</span> bots<span class="br0">)</span>
      <span class="kw3">Robot</span>.<span class="me1">Test</span>.<span class="me1">test</span><span class="br0">(</span>bot<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt; 
</p>
<pre>Название: SnowBee Модель: 
SnowBot Series 11 
SnowBee может убирать снег 
SnowBee убирает снег 
SnowBee может колоть лед 
SnowBee колет лед 
SnowBee может чистить крышу 
SnowBee чистит крышу 
[Null Robot]
Название: SnowRemova1 Robot NullRobot 
Модель: SnowRemovalRobot NullRobot
</pre>
<p>&lt;/spoiler&gt;
Каждый раз, когда вам требуется объект <i><b>Robot</b></i> с неопределенным состоянием, вы вызываете <i><b>newNullRobot()</b></i> и передаете тип <i><b>Robot</b></i>, для которого создается
посредник. Посредник выполняет требования о поддержке интерфейсов <i><b>Robot</b></i> и <i><b>Null</b></i>, а также предоставляет имя опосредованного типа.
</p>
<h2><span class="mw-headline" id=".D0.98.D0.BD.D1.82.D0.B5.D1.80.D1.84.D0.B5.D0.B9.D1.81.D1.8B_.D0.B8_.D0.B8.D0.BD.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D0.B8.D1.8F_.D0.BE_.D1.82.D0.B8.D0.BF.D0.B0.D1.85"><b>Интерфейсы и информация о типах</b></span></h2>
<p>Одной из важных целей ключевого слова <i><b>interface</b></i> является изоляция компонентов и сокращение привязок. Использование интерфейсов вроде бы позволяет добиться этой цели, однако <i>RTTI</i> позволяет обойти ограничения — интерфейсы не обеспечивают стопроцентной изоляции. Начнем следующий пример с интерфейса:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/interfacea/A.java </span>
<span class="kw1">package</span> <span class="co2">typeinfo.interfaces</span><span class="sy0">;</span>
 <span class="kw1">public</span> <span class="kw1">interface</span> A <span class="br0">{</span>
     <span class="kw4">void</span> f<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> 
<span class="br0">}</span></pre></div></div>
<p>Затем интерфейс реализуется, и выясняется, что можно «в обход» добраться до фактического типа реализации:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/InterfaceViolation.java</span>
<span class="co1">// Интерфейс можно обойти</span>
<span class="kw1">import</span> <span class="co2">typeinfo.interfacea.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">class</span> B <span class="kw1">implements</span> A <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw4">void</span> f<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">void</span> g<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> InterfaceViolation <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="br0">{</span>
    A a <span class="sy0">=</span> <span class="kw1">new</span> B<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    a.<span class="me1">f</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">// a.g(); // // Ошибка компиляции</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>a.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getName</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw1">if</span><span class="br0">(</span>a <span class="kw1">instanceof</span> B<span class="br0">)</span> <span class="br0">{</span>
      B b <span class="sy0">=</span> <span class="br0">(</span>B<span class="br0">)</span>a<span class="sy0">;</span>
      b.<span class="me1">g</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt; 
</p>
<pre>В
</pre>
<p>&lt;/spoiler&gt;
Используя <i>RTTI</i>, мы выясняем, что объект а реализован в форме <i><b>В</b></i>. Преобразование к типу <i><b>В</b></i> позволяет вызвать метод, не входящий в интерфейс <i><b>А</b></i>.
Все это абсолютно законно и допустимо, но, скорее всего, вы предпочли бы
 оградить клиентских программистов от подобных выходок. Казалось бы, 
ключевое слово <i><b>interaface</b></i> должно защищать вас, но на самом деле этого не происходит, а факт использования <i><b>В</b></i> для реализации <i><b>А</b></i>
 становится известен любому желающему.
Одно из возможных решений: просто скажите программистам, что если они 
будут использовать фактический класс вместо интерфейса, то пускай сами 
разбираются со всеми возникающими проблемами. Вероятно, во многих 
случаях этого достаточно, но если «вероятно» вас не устраивает — можно 
применить более жесткие меры.
Проще всего установить для реализации пакетный уровень доступа, чтобы 
она оставалась невидимой для клиентов за пределами пакета:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/packageaccess/HiddenC.java</span>
<span class="kw1">package</span> <span class="co2">typeinfo.packageaccess</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">typeinfo.interfacea.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">static</span> net.<span class="me1">mindview</span>.<span class="me1">util</span>.<span class="me1">Print</span>.<span class="sy0">*;</span>
&nbsp;
<span class="kw1">class</span> C <span class="kw1">implements</span> A <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw4">void</span> f<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"public C.f()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw4">void</span> g<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"public C.g()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
  <span class="kw4">void</span> u<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"package C.u()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
  <span class="kw1">protected</span> <span class="kw4">void</span> v<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"protected C.v()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
  <span class="kw1">private</span> <span class="kw4">void</span> w<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"private C.w()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> HiddenC <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> A makeA<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> <span class="kw1">new</span> C<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>Единственная открытая (<i><b>public</b></i>) часть пакета, <i><b>HiddenC</b></i>, выдает интерфейс <i><b>А</b></i> при вызове. Интересно отметить, что, даже если <i><b>makeA()</b></i> будет возвращать <i><b>С</b></i>, за пределами пакета все равно удастся использовать только <i><b>А</b></i>, потому что имя <i><b>С</b></i> недоступно.
Попытка нисходящего преобразования к <i><b>С</b></i> тоже завершается неудачей:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/HiddenImplementation.java</span>
<span class="co1">// Пакетный доступ тоже можно обойти</span>
<span class="kw1">import</span> <span class="co2">typeinfo.interfacea.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">typeinfo.packageaccess.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">java.lang.reflect.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> HiddenImplementation <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="kw1">throws</span> <span class="kw3">Exception</span> <span class="br0">{</span>
    A a <span class="sy0">=</span> HiddenC.<span class="me1">makeA</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    a.<span class="me1">f</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>a.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getName</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">// Ошибка компиляции, символическое имя 'С' не найдено </span>
    <span class="coMULTI">/* if(a instanceof C) {
      C c = (C)a;
      c.g();
    } */</span>
    <span class="co1">// Однако рефлексия позволяет вызвать g():</span>
    callHiddenMethod<span class="br0">(</span>a, <span class="st0">"g"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">// ... И даже еще менее доступные методы! </span>
    callHiddenMethod<span class="br0">(</span>a, <span class="st0">"u"</span><span class="br0">)</span><span class="sy0">;</span>
    callHiddenMethod<span class="br0">(</span>a, <span class="st0">"v"</span><span class="br0">)</span><span class="sy0">;</span>
    callHiddenMethod<span class="br0">(</span>a, <span class="st0">"w"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
  <span class="kw1">static</span> <span class="kw4">void</span> callHiddenMethod<span class="br0">(</span><span class="kw3">Object</span> a, <span class="kw3">String</span> methodName<span class="br0">)</span>
  <span class="kw1">throws</span> <span class="kw3">Exception</span> <span class="br0">{</span>
    <span class="kw3">Method</span> g <span class="sy0">=</span> a.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getDeclaredMethod</span><span class="br0">(</span>methodName<span class="br0">)</span><span class="sy0">;</span>
    g.<span class="me1">setAccessible</span><span class="br0">(</span><span class="kw2">true</span><span class="br0">)</span><span class="sy0">;</span>
    g.<span class="me1">invoke</span><span class="br0">(</span>a<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>public C.f()
typeinfo.packageaccess.C
public C.g()
package C.u()
protected C.v()
private C.w()
</pre>
<p>&lt;/spoiler&gt;
Как видите, рефлексия позволяет вызвать все методы, даже приватные! Зная имя метода, можно вызвать <i><b>setAccessible(true</b></i>) для объекта <i><b>Method</b></i>, чтобы сделать возможным его вызов, как видно из реализации <i><b>callHiddenMethod()</b></i>.
Можно подумать, что проблема решается распространением только откомпилированного кода, но и это не так. Достаточно запустить <i><b>javap</b></i> — декомпилятор, входящий в <i>JDK</i>. Командная строка выглядит так:
</p>
<pre>javap -private С
</pre>
<p>Флаг <i><b>-private</b></i> означает, что при выводе должны 
отображаться все члены, даже приватные. Таким образом, любой желающий 
сможет получить имена и сигнатуры приватных методов и вызвать их.
А если реализовать интерфейс в виде приватного внутреннего класса? Вот 
как это выглядит:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/InnerImplementation.java</span>
<span class="co1">// Приватные внутренние классы не скрываются от рефлексии</span>
<span class="kw1">import</span> <span class="co2">typeinfo.interfacea.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">static</span> net.<span class="me1">mindview</span>.<span class="me1">util</span>.<span class="me1">Print</span>.<span class="sy0">*;</span>
&nbsp;
<span class="kw1">class</span> InnerA <span class="br0">{</span>
  <span class="kw1">private</span> <span class="kw1">static</span> <span class="kw1">class</span> C <span class="kw1">implements</span> A <span class="br0">{</span>
    <span class="kw1">public</span> <span class="kw4">void</span> f<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"public C.f()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="kw1">public</span> <span class="kw4">void</span> g<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"public C.g()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="kw4">void</span> u<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"package C.u()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="kw1">protected</span> <span class="kw4">void</span> v<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"protected C.v()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="kw1">private</span> <span class="kw4">void</span> w<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"private C.w()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
  <span class="br0">}</span>
  <span class="kw1">public</span> <span class="kw1">static</span> A makeA<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> <span class="kw1">return</span> <span class="kw1">new</span> C<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
<span class="br0">}</span>	
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> InnerImplementation <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="kw1">throws</span> <span class="kw3">Exception</span> <span class="br0">{</span>
    A a <span class="sy0">=</span> InnerA.<span class="me1">makeA</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    a.<span class="me1">f</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>a.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getName</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">// Reflection still gets into the private class:</span>
    HiddenImplementation.<span class="me1">callHiddenMethod</span><span class="br0">(</span>a, <span class="st0">"g"</span><span class="br0">)</span><span class="sy0">;</span>
    HiddenImplementation.<span class="me1">callHiddenMethod</span><span class="br0">(</span>a, <span class="st0">"u"</span><span class="br0">)</span><span class="sy0">;</span>
    HiddenImplementation.<span class="me1">callHiddenMethod</span><span class="br0">(</span>a, <span class="st0">"v"</span><span class="br0">)</span><span class="sy0">;</span>
    HiddenImplementation.<span class="me1">callHiddenMethod</span><span class="br0">(</span>a, <span class="st0">"w"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>public C.f()
InnerA$C
public C.g()
package C.u()
protected C.v()
private C.w()
</pre>
<p>&lt;/spoiler&gt;
He помогло. Как насчет анонимного класса?
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/AnonymousImplementation.java</span>
<span class="co1">// Анонимные внутренние классы тоже не скрыты от рефлексии</span>
<span class="kw1">import</span> <span class="co2">typeinfo.interfacea.*</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">static</span> net.<span class="me1">mindview</span>.<span class="me1">util</span>.<span class="me1">Print</span>.<span class="sy0">*;</span>
&nbsp;
<span class="kw1">class</span> AnonymousA <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> A makeA<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">return</span> <span class="kw1">new</span> A<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
      <span class="kw1">public</span> <span class="kw4">void</span> f<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"public C.f()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
      <span class="kw1">public</span> <span class="kw4">void</span> g<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"public C.g()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
      <span class="kw4">void</span> u<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"package C.u()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
      <span class="kw1">protected</span> <span class="kw4">void</span> v<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"protected C.v()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
      <span class="kw1">private</span> <span class="kw4">void</span> w<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span> print<span class="br0">(</span><span class="st0">"private C.w()"</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>
    <span class="br0">}</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span>	
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> AnonymousImplementation <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="kw1">throws</span> <span class="kw3">Exception</span> <span class="br0">{</span>
    A a <span class="sy0">=</span> AnonymousA.<span class="me1">makeA</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    a.<span class="me1">f</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>a.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getName</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">// Reflection still gets into the anonymous class:</span>
    HiddenImplementation.<span class="me1">callHiddenMethod</span><span class="br0">(</span>a, <span class="st0">"g"</span><span class="br0">)</span><span class="sy0">;</span>
    HiddenImplementation.<span class="me1">callHiddenMethod</span><span class="br0">(</span>a, <span class="st0">"u"</span><span class="br0">)</span><span class="sy0">;</span>
    HiddenImplementation.<span class="me1">callHiddenMethod</span><span class="br0">(</span>a, <span class="st0">"v"</span><span class="br0">)</span><span class="sy0">;</span>
    HiddenImplementation.<span class="me1">callHiddenMethod</span><span class="br0">(</span>a, <span class="st0">"w"</span><span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>public C.f()
AnonymousA$1
public C.g()
package C.u()
protected C.v()
private C.w()
</pre>
<p>&lt;/spoiler&gt;
Похоже, не существует никакого способа предотвратить обращение и вызов методов с уровнем доступа, отличным от <i><b>public</b></i>, посредством рефлексии. Сказанное относится и к полям данных, даже к приватным:
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="java source-java"><pre class="de1"><span class="co1">//: typeinfo/ModifyingPrivateFields.java</span>
<span class="kw1">import</span> <span class="co2">java.lang.reflect.*</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">class</span> WithPrivateFinalField <span class="br0">{</span>
  <span class="kw1">private</span> <span class="kw4">int</span> i <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span>
  <span class="kw1">private</span> <span class="kw1">final</span> <span class="kw3">String</span> s <span class="sy0">=</span> <span class="st0">"I'm totally safe"</span><span class="sy0">;</span>
  <span class="kw1">private</span> <span class="kw3">String</span> s2 <span class="sy0">=</span> <span class="st0">"Am I safe?"</span><span class="sy0">;</span>
  <span class="kw1">public</span> <span class="kw3">String</span> toString<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">return</span> <span class="st0">"i = "</span> <span class="sy0">+</span> i <span class="sy0">+</span> <span class="st0">", "</span> <span class="sy0">+</span> s <span class="sy0">+</span> <span class="st0">", "</span> <span class="sy0">+</span> s2<span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> ModifyingPrivateFields <span class="br0">{</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">(</span><span class="kw3">String</span><span class="br0">[</span><span class="br0">]</span> args<span class="br0">)</span> <span class="kw1">throws</span> <span class="kw3">Exception</span> <span class="br0">{</span>
    WithPrivateFinalField pf <span class="sy0">=</span> <span class="kw1">new</span> WithPrivateFinalField<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>pf<span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">Field</span> f <span class="sy0">=</span> pf.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getDeclaredField</span><span class="br0">(</span><span class="st0">"i"</span><span class="br0">)</span><span class="sy0">;</span>
    f.<span class="me1">setAccessible</span><span class="br0">(</span><span class="kw2">true</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"f.getInt(pf): "</span> <span class="sy0">+</span> f.<span class="me1">getInt</span><span class="br0">(</span>pf<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    f.<span class="me1">setInt</span><span class="br0">(</span>pf, <span class="nu0">47</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>pf<span class="br0">)</span><span class="sy0">;</span>
    f <span class="sy0">=</span> pf.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getDeclaredField</span><span class="br0">(</span><span class="st0">"s"</span><span class="br0">)</span><span class="sy0">;</span>
    f.<span class="me1">setAccessible</span><span class="br0">(</span><span class="kw2">true</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"f.get(pf): "</span> <span class="sy0">+</span> f.<span class="me1">get</span><span class="br0">(</span>pf<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    f.<span class="me1">set</span><span class="br0">(</span>pf, <span class="st0">"No, you're not!"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>pf<span class="br0">)</span><span class="sy0">;</span>
    f <span class="sy0">=</span> pf.<span class="me1">getClass</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">getDeclaredField</span><span class="br0">(</span><span class="st0">"s2"</span><span class="br0">)</span><span class="sy0">;</span>
    f.<span class="me1">setAccessible</span><span class="br0">(</span><span class="kw2">true</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span><span class="st0">"f.get(pf): "</span> <span class="sy0">+</span> f.<span class="me1">get</span><span class="br0">(</span>pf<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    f.<span class="me1">set</span><span class="br0">(</span>pf, <span class="st0">"No, you're not!"</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="kw3">System</span>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">(</span>pf<span class="br0">)</span><span class="sy0">;</span>
  <span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>&lt;spoiler text="Output:"&gt;
</p>
<pre>i = 1, I'm totally safe, Am I safe?
f.getInt(pf): 1
i = 47, I'm totally safe, Am I safe?
f.get(pf): I'm totally safe
i = 47, I'm totally safe, Am I safe?
f.get(pf): Am I safe?
i = 47, I'm totally safe, No, you're not!
</pre>
<p>&lt;/spoiler&gt;
Впрочем, <i><b>final</b></i>-поля защищены от изменений. Система времени
 выполнения спокойно воспринимает любые попытки их изменения, но при 
этом ничего не происходит.
В действительности все эти нарушения уровня доступа не так уж страшны. 
Если кто-то захочет вызывать методы, которым вы назначили приватный или 
пакетный доступ (тем самым ясно показывая, что вызывать их не следует), 
вряд ли он станет жаловаться на то, что вы изменили некоторые аспекты 
этих методов. С другой стороны, «черный ход» к внутреннему устройству 
класса позволяет решить некоторые проблемы, нерешаемые другими 
средствами, и в общем случае преимущества рефлексии неоспоримы.
</p>
<h2><span class="mw-headline" id=".D0.A0.D0.B5.D0.B7.D1.8E.D0.BC.D0.B5"><b>Резюме</b></span></h2>
<p>Динамическое определение типов (<i>RTTI</i>) позволяет вам получить 
информацию о точном типе объекта тогда, когда у вас для него имеется 
лишь ссылка базового типа. Таким образом, оно открывает широкие 
возможности для злоупотреблений со стороны новичков, которые еще не 
поняли и не успели оценить всю мощь полиморфизма. У многих людей, ранее 
работавших с процедурными языками, возникает сильное желание разбить 
свою программу на множество конструкций <i><b>switch</b></i> при помощи <i>RTTI</i>.
 Однако при этом они лишаются всех преимуществ полиморфизма, относящихся
 к разработке программы в целом и ее дальнейшей поддержке. В <i>Java</i> рекомендуется использовать именно полиморфные методы, а к услугам <i>RTTI</i> следует прибегать только в крайнем случае.
</p><p>Впрочем, при использовании полиморфных методов требуется полный 
контроль над базовым классом, поскольку в некоторой точке программы, 
после наследования очередного класса, вы можете обнаружить, что базовый 
класс не со­держит нужного вам метода, и тогда <i>RTTI</i> вас выручит: 
при наследовании вы расширяете интерфейс класса, добавляя в него новые 
методы. Особенно верно это при использовании в качестве базовых классов 
библиотек, которые вы не можете изменить. Далее в своем коде в 
подходящий момент вы обнаруживаете новый тип и вызываете для него нужный
 метод. Такой подход не противоречит основам полиморфизма и 
расширяемости программы, так как добавление в программу нового типа не 
требует изменения бесчисленного множества конструкций <i><b>switch</b></i>. Но чтобы извлечь пользу из дополнительной функциональности нового класса, придется использовать <i>RTTI</i>.
</p><p>Включение некоторого метода в базовый класс будет выгодно только 
одному производному классу, который действительно реализует его, но все 
остальные производные классы будут вынуждены использовать для этого 
метода какую-либо бесполезную «заглушку». Интерфейс базового класса 
«размывается» и раздражает тех, кому приходится переопределять ненужные 
абстрактные методы при наследовании от базового класса. Например, 
рассмотрим иерархию классов, представляющих музыкальные инструменты. 
Предположим, что вы хотите прочистить мундштуки духовых инструментов 
своего оркестра. Конечно, можно поместить в базовый класс <i><b>Instrument</b></i> (общее представление музыкального инструмента) еще один метод <i><b>clearSpitValve()</b></i> (прочистка мундштуков), но тогда получится, что и у синтезатора, и у барабана есть мундштук! С помощью <i>RTTI</i>
 можно получить гораздо более верное решение данной задачи, поскольку 
этот метод уместно поместить в более конкретный класс (например, в класс
 <i><b>Wind</b></i>, базовый для всех духовых инструментов). Однако еще более разумным стало бы включение в класс <i><b>Instrument</b></i> метода <i><b>prepareInstrument()</b></i>
 (подготовить инструмент к игре), который подошел бы всем инструментам 
без исключения. На первый взгляд можно было бы ошибочно решить, что в 
данном случае без <i>RTTI</i> не обойтись.
</p><p>Наконец, иногда <i>RTTI</i> решает проблемы производительности. 
Если ваш код использует полиморфизм по всем правилам, но один из 
объектов чрезвычайно непродуктивно обрабатывается кодом, предназначенным
 для базового типа, то для этого объекта можно сделать исключение, 
определить его точный тип с помощью <i>RTTI</i> и работать с ним более 
производительно. Однако ни в коем случае не следует писать программы, 
ориентируясь только на их эффективность, как бы соблазнительно это ни 
было. Сначала надо получить работающую программу и только после этого 
решать, достаточно ли быстро она работает, и решать проблемы 
быстродействия, вооружившись инструментами для проверки скорости 
исполнения.
</p><p>Мы также видели, что рефлексия открывает перед программистом 
множество новых возможностей и делает возможным более динамичный стиль 
программирования. Пожалуй, динамическая природа рефлексии кому-то 
покажется пу­гающей. Для тех, кто привык к безопасной статической 
проверке типов, сама возможность выполнения действий, правильность 
которых проверяется только на стадии выполнения, а для выдачи информации
 используются исключения, выглядит шагом в неверном направлении. 
Некоторые доходят до утверждений, будто сама возможность исключения на 
стадии выполнения свидетельствует о том, что такого кода лучше избегать.
 На мой взгляд, чувство безопасности весьма иллюзорно — неожиданности и 
исключения возможны всегда, даже если программа не содержит блоков <i><b>try</b></i>
 и спецификации исключений. Предпочитаю думать, что существование 
логически целостной модели выдачи информации об ошибках дает возможность
 писать динамический код с использованием рефлексии. Конечно, всегда 
желательно писать код со статической проверкой... когда это возможно. И 
все же динамический код является одной из важнейших особенностей, 
отделяющих <i>Java</i> от таких традиционных языков, как <i>C++</i>.

</p>
                <p><br>
                </p>
                <hr>
                <p><a href="http://wikijava.it-cache.net/index.php" title="Thinking in Java 4th edition">назад в Оглавление</a>
                </p><p><br>
                </p>
<!-- 
NewPP limit report
CPU time usage: 2.720 seconds
Real time usage: 2.724 seconds
Preprocessor visited node count: 550/1000000
Preprocessor generated node count: 1188/1000000
Post‐expand include size: 243/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key wjava2-wj_:pcache:idhash:27-0!*!*!!ru!2!* and timestamp 20140813054034
 -->
</div>								<div class="printfooter">
				Источник — «<a href="http://wikijava.org.ua/index.php?title=Glava_13_Thinking_in_Java_4th_edition&amp;oldid=37">http://wikijava.org.ua/index.php?title=Глава_13_Thinking_in_Java_4th_edition&amp;oldid=37</a>»				</div>
                                <div id="catlinks" class="catlinks"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="http://wikijava.org.ua/index.php?title=%D0%A1%D0%BB%D1%83%D0%B6%D0%B5%D0%B1%D0%BD%D0%B0%D1%8F:%D0%9A%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D0%B8" title="Служебная:Категории">Категории</a>: <ul><li><a href="http://wikijava.org.ua/index.php?title=%D0%9A%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D1%8F:%D0%9A%D0%BD%D0%B8%D0%B3%D0%B8" title="Категория:Книги">Книги</a></li><li><a href="http://wikijava.org.ua/index.php?title=%D0%9A%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D1%8F:Java" title="Категория:Java">Java</a></li></ul></div></div>												<div class="visualClear"></div>
            </div>
		</div>
		<div id="mw-navigation">
			<h2>Навигация</h2>
			<div id="mw-head">
				<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Персональные инструменты</h3>
	<ul>
<li id="pt-login"><a href="http://wikijava.org.ua/index.php?title=%D0%A1%D0%BB%D1%83%D0%B6%D0%B5%D0%B1%D0%BD%D0%B0%D1%8F:%D0%92%D1%85%D0%BE%D0%B4&amp;returnto=%D0%93%D0%BB%D0%B0%D0%B2%D0%B0+13+Thinking+in+Java+4th+edition" title="Здесь можно зарегистрироваться в системе, но это необязательно. [o]" accesskey="o">Представиться системе</a></li>	</ul>
</div>
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Пространства имён</h3>
	<ul>
					<!--<li  id="ca-nstab-main" class="selected"><span><a href="index.php@title=Glava_13_Thinking_in_Java_4th_edition.html"  title="Просмотр основной страницы [c]" accesskey="c">Статья</a></span></li>-->
					<!--<li  id="ca-talk" class="new"><span><a href="http://wikijava.org.ua/index.php?title=%D0%9E%D0%B1%D1%81%D1%83%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5:%D0%93%D0%BB%D0%B0%D0%B2%D0%B0_13_Thinking_in_Java_4th_edition&amp;action=edit&amp;redlink=1"  title="Обсуждение основной страницы [t]" accesskey="t">Обсуждение</a></span></li>-->
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 id="p-variants-label"><span>Варианты</span><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Просмотры</h3>
	<ul>
					<!--<li id="ca-view" class="selected"><span><a href="index.php@title=Glava_13_Thinking_in_Java_4th_edition.html" >Читать</a></span></li>-->
					<!--<li id="ca-viewsource"><span><a href="http://wikijava.org.ua/index.php?title=%D0%93%D0%BB%D0%B0%D0%B2%D0%B0_13_Thinking_in_Java_4th_edition&amp;action=edit"  title="Эта страница защищена от изменений, но вы можете посмотреть и скопировать её исходный текст [e]" accesskey="e">Просмотр</a></span></li>-->
					<!--<li id="ca-history" class="collapsible"><span><a href="http://wikijava.org.ua/index.php?title=%D0%93%D0%BB%D0%B0%D0%B2%D0%B0_13_Thinking_in_Java_4th_edition&amp;action=history"  title="Журнал изменений страницы [h]" accesskey="h">История</a></span></li>-->
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 id="p-cactions-label"><span>Действия</span><a href="http://wikijava.it-cache.net/index.php@title=Glava_13_Thinking_in_Java_4th_edition.html#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-search" role="search">
	<h3><label for="searchInput">Поиск</label></h3>
	<form action="http://wikijava.org.ua/index.php" id="searchform">
				<div id="simpleSearch">
						<input name="search" placeholder="Поиск" title="Искать в WikiJava: Wiki of Java: викифицированные книги и статьи по Java [f]" accesskey="f" id="searchInput">						<button type="submit" name="button" title="Найти страницы, содержащие указанный текст" id="searchButton"><img src="%D0%93%D0%BB%D0%B0%D0%B2%D0%B0%2013_files/search-ltr.asc" alt="Найти" height="13" width="12"></button>								<input name="title" value="Служебная:Поиск" type="hidden">
		</div>
	</form>
</div>
				</div>
			</div>
			<div id="mw-panel">
					<!--<div id="p-logo" role="banner"><a style="background-image: url(/skins/common/images/wikijava.png);" href="index.php@title=Заглавная_страница.html"  title="Перейти на заглавную страницу"></a></div>-->
				<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
	<h3 id="p-navigation-label">Навигация</h3>
	<div class="body">
        <ul>
            <li id="n-mainpage-description"><a href="http://wikijava.org.ua/index.php?title=%D0%97%D0%B0%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0" title="Перейти на заглавную страницу [z]" accesskey="z">Заглавная страница</a></li>
            <li id="n-recentchanges"><a href="http://wikijava.org.ua/index.php?title=%D0%A1%D0%BB%D1%83%D0%B6%D0%B5%D0%B1%D0%BD%D0%B0%D1%8F:%D0%A1%D0%B2%D0%B5%D0%B6%D0%B8%D0%B5_%D0%BF%D1%80%D0%B0%D0%B2%D0%BA%D0%B8" title="Список последних изменений [r]" accesskey="r">Свежие правки</a></li>
            <li id="n-.D0.9A.D0.BD.D0.B8.D0.B3.D0.B8-Java"><a href="http://wikijava.org.ua/index.php?title=%D0%9A%D0%BD%D0%B8%D0%B3%D0%B8_Java">Книги Java</a></li>
            <li id="n-.D0.A1.D1.82.D0.B0.D1.82.D1.8C.D0.B8-Java"><a href="http://wikijava.org.ua/index.php?title=%D0%A1%D1%82%D0%B0%D1%82%D1%8C%D0%B8_Java">Статьи Java</a></li>
            <li id="n-Java-.D0.BF.D0.BE.D1.80.D1.82.D0.B0.D0.BB"><a href="http://wikijava.org.ua/index.php?title=Java-portal">Java портал</a></li>
            <li id="n-help"><a href="http://wikijava.org.ua/index.php?title=%D0%A1%D0%BF%D1%80%D0%B0%D0%B2%D0%BA%D0%B0:%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5" title="Место, где можно получить справку">Справка</a></li>
            <li id="n-.D0.A1.D1.82.D0.B0.D1.82.D0.B8.D1.81.D1.82.D0.B8.D0.BA.D0.B0"><a href="http://wikijava.org.ua/index.php?title=%D0%A1%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D0%BA%D0%B0">Статистика</a></li>
        </ul>
	</div>
</div>
<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
	<h3 id="p-tb-label">Инструменты</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="http://wikijava.org.ua/index.php?title=%D0%A1%D0%BB%D1%83%D0%B6%D0%B5%D0%B1%D0%BD%D0%B0%D1%8F:%D0%A1%D1%81%D1%8B%D0%BB%D0%BA%D0%B8_%D1%81%D1%8E%D0%B4%D0%B0/%D0%93%D0%BB%D0%B0%D0%B2%D0%B0_13_Thinking_in_Java_4th_edition" title="Список всех страниц, ссылающихся на данную [j]" accesskey="j">Ссылки сюда</a></li>
			<li id="t-recentchangeslinked"><a href="http://wikijava.org.ua/index.php?title=%D0%A1%D0%BB%D1%83%D0%B6%D0%B5%D0%B1%D0%BD%D0%B0%D1%8F:%D0%A1%D0%B2%D1%8F%D0%B7%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5_%D0%BF%D1%80%D0%B0%D0%B2%D0%BA%D0%B8/%D0%93%D0%BB%D0%B0%D0%B2%D0%B0_13_Thinking_in_Java_4th_edition" title="Последние изменения в страницах, на которые ссылается эта страница [k]" accesskey="k">Связанные правки</a></li>
			<li id="t-specialpages"><a href="http://wikijava.org.ua/index.php?title=%D0%A1%D0%BB%D1%83%D0%B6%D0%B5%D0%B1%D0%BD%D0%B0%D1%8F:%D0%A1%D0%BF%D0%B5%D1%86%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D1%8B" title="Список служебных страниц [q]" accesskey="q">Спецстраницы</a></li>
			<li id="t-print"><a href="http://wikijava.org.ua/index.php?title=%D0%93%D0%BB%D0%B0%D0%B2%D0%B0_13_Thinking_in_Java_4th_edition&amp;printable=yes" rel="alternate" title="Версия этой страницы для печати [p]" accesskey="p">Версия для печати</a></li>
			<li id="t-permalink"><a href="http://wikijava.org.ua/index.php?title=%D0%93%D0%BB%D0%B0%D0%B2%D0%B0_13_Thinking_in_Java_4th_edition&amp;oldid=37" title="Постоянная ссылка на эту версию страницы">Постоянная ссылка</a></li>
			<li id="t-info"><a href="http://wikijava.org.ua/index.php?title=%D0%93%D0%BB%D0%B0%D0%B2%D0%B0_13_Thinking_in_Java_4th_edition&amp;action=info">Сведения о странице</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id="p-.D0.94.D1.80.D1.83.D0.B3.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B5.D0.BA.D1.82.D1.8B" aria-labelledby="p-.D0.94.D1.80.D1.83.D0.B3.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B5.D0.BA.D1.82.D1.8B-label">
	<h3 id="p-.D0.94.D1.80.D1.83.D0.B3.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B5.D0.BA.D1.82.D1.8B-label">Другие проекты</h3>
	<div class="body">
		<ul>
			<li id="n-rastafara.com.ua"><a href="http://rastafara.com.ua/" rel="nofollow">rastafara.com.ua</a></li>
			<li id="n-rastafara-blog"><a href="http://sergey-rastafara.blogspot.com/" rel="nofollow">rastafara blog</a></li>
			<li id="n-rastaban"><a href="http://rastaban.com.ua/" rel="nofollow">rastaban</a></li>
		</ul>
	</div>
</div>
			</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> Последнее изменение этой страницы: 21:49, 16 февраля 2014.</li>
											<li id="footer-info-viewcount">К этой странице обращались 2247 раза.</li>
											<li id="footer-info-copyright">Содержимое доступно по лицензии <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 или более поздняя</a> (если не указано иное).</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="http://wikijava.org.ua/index.php?title=WikiJava:_Wiki_of_Java:_%D0%B2%D0%B8%D0%BA%D0%B8%D1%84%D0%B8%D1%86%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5_%D0%BA%D0%BD%D0%B8%D0%B3%D0%B8_%D0%B8_%D1%81%D1%82%D0%B0%D1%82%D1%8C%D0%B8_%D0%BF%D0%BE_Java:%D0%9F%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0_%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B4%D0%B5%D0%BD%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D0%B8" title="WikiJava: Wiki of Java: викифицированные книги и статьи по Java:Политика конфиденциальности">Политика конфиденциальности</a></li>
											<li id="footer-places-about"><a href="http://wikijava.org.ua/index.php?title=WikiJava:_Wiki_of_Java:_%D0%B2%D0%B8%D0%BA%D0%B8%D1%84%D0%B8%D1%86%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5_%D0%BA%D0%BD%D0%B8%D0%B3%D0%B8_%D0%B8_%D1%81%D1%82%D0%B0%D1%82%D1%8C%D0%B8_%D0%BF%D0%BE_Java:%D0%9E%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5" title="WikiJava: Wiki of Java: викифицированные книги и статьи по Java:Описание">Описание WikiJava: Wiki of Java: викифицированные книги и статьи по Java</a></li>
											<li id="footer-places-disclaimer"><a href="http://wikijava.org.ua/index.php?title=WikiJava:_Wiki_of_Java:_%D0%B2%D0%B8%D0%BA%D0%B8%D1%84%D0%B8%D1%86%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5_%D0%BA%D0%BD%D0%B8%D0%B3%D0%B8_%D0%B8_%D1%81%D1%82%D0%B0%D1%82%D1%8C%D0%B8_%D0%BF%D0%BE_Java:%D0%9E%D1%82%D0%BA%D0%B0%D0%B7_%D0%BE%D1%82_%D0%BE%D1%82%D0%B2%D0%B5%D1%82%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8" title="WikiJava: Wiki of Java: викифицированные книги и статьи по Java:Отказ от ответственности">Отказ от ответственности</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
					<li id="footer-copyrightico">
						<a href="http://www.gnu.org/copyleft/fdl.html"><img src="%D0%93%D0%BB%D0%B0%D0%B2%D0%B0%2013_files/gnu-fdl.png" alt="GNU Free Documentation License 1.3 или более поздняя" height="31" width="88"></a>
					</li>
					<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="%D0%93%D0%BB%D0%B0%D0%B2%D0%B0%2013_files/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" height="31" width="88"></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.vector.collapsibleNav","ext.vector.collapsibleTabs","ext.vector.editWarning","ext.vector.simpleSearch","skins.vector.collapsibleNav"],null,true);
}</script>
<script>if(window.mw){
mw.loader.state({"site":"ready"});
}</script>
<!-- Served in 0.232 secs. -->
	

</body></html>